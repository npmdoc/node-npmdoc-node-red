<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://nodered.org"

    >node-red (v0.16.2)</a>
</h1>
<h4>A visual tool for wiring the Internet of Things</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red">module node-red</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node">
            function <span class="apidocSignatureSpan">node-red.</span>Node
            <span class="apidocSignatureSpan">(n)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.init">
            function <span class="apidocSignatureSpan">node-red.</span>init
            <span class="apidocSignatureSpan">(httpServer, userSettings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.start">
            function <span class="apidocSignatureSpan">node-red.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.stop">
            function <span class="apidocSignatureSpan">node-red.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.version">
            function <span class="apidocSignatureSpan">node-red.</span>version
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>Node.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>clients</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>comms</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>context</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>credentials</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>flow</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>flows</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>httpAdmin</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>httpNode</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>i18n</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>index</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>info</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>library</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>locales</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>localfilesystem</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>log</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>nodes</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>permissions</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>server</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>settings</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>strategies</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>theme</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>tokens</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>ui</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>users</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.</span>util</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.Node">module node-red.Node</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.Node">
            function <span class="apidocSignatureSpan">node-red.</span>Node
            <span class="apidocSignatureSpan">(n)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.super_">
            function <span class="apidocSignatureSpan">node-red.Node.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.Node.prototype">module node-red.Node.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype._on">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>_on
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.close">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>close
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.context">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>context
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.error">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>error
            <span class="apidocSignatureSpan">(logMessage, msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.log">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>log
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.metric">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>metric
            <span class="apidocSignatureSpan">(eventname, msg, metricValue)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.on">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>on
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.receive">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>receive
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.send">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>send
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.status">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>status
            <span class="apidocSignatureSpan">(status)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.updateWires">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>updateWires
            <span class="apidocSignatureSpan">(wires)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.Node.prototype.warn">
            function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>warn
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.auth">module node-red.auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.auth.needsPermission">
            function <span class="apidocSignatureSpan">node-red.auth.</span>needsPermission
            <span class="apidocSignatureSpan">(permission)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.clients">module node-red.clients</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.clients.get">
            function <span class="apidocSignatureSpan">node-red.clients.</span>get
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.comms">module node-red.comms</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.comms.publish">
            function <span class="apidocSignatureSpan">node-red.comms.</span>publish
            <span class="apidocSignatureSpan">(topic, data, retain)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.context">module node-red.context</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.context.clean">
            function <span class="apidocSignatureSpan">node-red.context.</span>clean
            <span class="apidocSignatureSpan">(flowConfig)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.context.delete">
            function <span class="apidocSignatureSpan">node-red.context.</span>delete
            <span class="apidocSignatureSpan">(id, flowId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.context.get">
            function <span class="apidocSignatureSpan">node-red.context.</span>get
            <span class="apidocSignatureSpan">(localId, flowId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.context.init">
            function <span class="apidocSignatureSpan">node-red.context.</span>init
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.credentials">module node-red.credentials</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.credentials.get">
            function <span class="apidocSignatureSpan">node-red.credentials.</span>get
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.credentials.init">
            function <span class="apidocSignatureSpan">node-red.credentials.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.flow">module node-red.flow</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flow.delete">
            function <span class="apidocSignatureSpan">node-red.flow.</span>delete
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flow.get">
            function <span class="apidocSignatureSpan">node-red.flow.</span>get
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flow.init">
            function <span class="apidocSignatureSpan">node-red.flow.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flow.post">
            function <span class="apidocSignatureSpan">node-red.flow.</span>post
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flow.put">
            function <span class="apidocSignatureSpan">node-red.flow.</span>put
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.flows">module node-red.flows</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flows.get">
            function <span class="apidocSignatureSpan">node-red.flows.</span>get
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flows.init">
            function <span class="apidocSignatureSpan">node-red.flows.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.flows.post">
            function <span class="apidocSignatureSpan">node-red.flows.</span>post
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.i18n">module node-red.i18n</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.i18n._">
            function <span class="apidocSignatureSpan">node-red.i18n.</span>_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.i18n.catalog">
            function <span class="apidocSignatureSpan">node-red.i18n.</span>catalog
            <span class="apidocSignatureSpan">(namespace, lang)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.i18n.init">
            function <span class="apidocSignatureSpan">node-red.i18n.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.i18n.registerMessageCatalog">
            function <span class="apidocSignatureSpan">node-red.i18n.</span>registerMessageCatalog
            <span class="apidocSignatureSpan">(namespace, dir, file)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.i18n.registerMessageCatalogs">
            function <span class="apidocSignatureSpan">node-red.i18n.</span>registerMessageCatalogs
            <span class="apidocSignatureSpan">(catalogs)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.i18n.</span>i</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">node-red.i18n.</span>defaultLang</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.index">module node-red.index</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.index.init">
            function <span class="apidocSignatureSpan">node-red.index.</span>init
            <span class="apidocSignatureSpan">(_server, _runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.index.start">
            function <span class="apidocSignatureSpan">node-red.index.</span>start
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.index.stop">
            function <span class="apidocSignatureSpan">node-red.index.</span>stop
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.index.</span>auth</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.index.</span>comms</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.index.</span>library</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.info">module node-red.info</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.info.init">
            function <span class="apidocSignatureSpan">node-red.info.</span>init
            <span class="apidocSignatureSpan">(_runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.info.settings">
            function <span class="apidocSignatureSpan">node-red.info.</span>settings
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.library">module node-red.library</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.library.register">
            function <span class="apidocSignatureSpan">node-red.library.</span>register
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.locales">module node-red.locales</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.locales.determineLangFromHeaders">
            function <span class="apidocSignatureSpan">node-red.locales.</span>determineLangFromHeaders
            <span class="apidocSignatureSpan">(acceptedLanguages)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.locales.get">
            function <span class="apidocSignatureSpan">node-red.locales.</span>get
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.locales.init">
            function <span class="apidocSignatureSpan">node-red.locales.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.localfilesystem">module node-red.localfilesystem</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.getCredentials">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getCredentials
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.getFlows">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getFlows
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.getLibraryEntry">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getLibraryEntry
            <span class="apidocSignatureSpan">(type, path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.getSessions">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getSessions
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.getSettings">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getSettings
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.init">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>init
            <span class="apidocSignatureSpan">(_settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.saveCredentials">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveCredentials
            <span class="apidocSignatureSpan">(credentials)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.saveFlows">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveFlows
            <span class="apidocSignatureSpan">(flows)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.saveLibraryEntry">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveLibraryEntry
            <span class="apidocSignatureSpan">(type, path, meta, body)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.saveSessions">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveSessions
            <span class="apidocSignatureSpan">(sessions)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.localfilesystem.saveSettings">
            function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveSettings
            <span class="apidocSignatureSpan">(newSettings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.log">module node-red.log</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.log">
            function <span class="apidocSignatureSpan">node-red.</span>log
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log._">
            function <span class="apidocSignatureSpan">node-red.log.</span>_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.addHandler">
            function <span class="apidocSignatureSpan">node-red.log.</span>addHandler
            <span class="apidocSignatureSpan">(func)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.audit">
            function <span class="apidocSignatureSpan">node-red.log.</span>audit
            <span class="apidocSignatureSpan">(msg, req)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.debug">
            function <span class="apidocSignatureSpan">node-red.log.</span>debug
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.error">
            function <span class="apidocSignatureSpan">node-red.log.</span>error
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.info">
            function <span class="apidocSignatureSpan">node-red.log.</span>info
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.init">
            function <span class="apidocSignatureSpan">node-red.log.</span>init
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.metric">
            function <span class="apidocSignatureSpan">node-red.log.</span>metric
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.removeHandler">
            function <span class="apidocSignatureSpan">node-red.log.</span>removeHandler
            <span class="apidocSignatureSpan">(func)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.trace">
            function <span class="apidocSignatureSpan">node-red.log.</span>trace
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.log.warn">
            function <span class="apidocSignatureSpan">node-red.log.</span>warn
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>AUDIT</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>DEBUG</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>ERROR</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>FATAL</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>INFO</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>METRIC</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>TRACE</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">node-red.log.</span>WARN</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.nodes">module node-red.nodes</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.addCredentials">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>addCredentials
            <span class="apidocSignatureSpan">(id, creds)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.addFlow">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>addFlow
            <span class="apidocSignatureSpan">(flow)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.cleanModuleList">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>cleanModuleList
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.clearRegistry">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>clearRegistry
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.createNode">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>createNode
            <span class="apidocSignatureSpan">(node, def)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.deleteCredentials">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>deleteCredentials
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.disableNode">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>disableNode
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.eachNode">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>eachNode
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.enableNode">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>enableNode
            <span class="apidocSignatureSpan">(typeOrId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getCredentialDefinition">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getCredentialDefinition
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getCredentials">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getCredentials
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getFlow">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getFlow
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getFlows">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getFlows
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getModuleInfo">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getModuleInfo
            <span class="apidocSignatureSpan">(module)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getNode">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getNode
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getNodeConfig">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeConfig
            <span class="apidocSignatureSpan">(id, lang)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getNodeConfigs">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeConfigs
            <span class="apidocSignatureSpan">(lang)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getNodeInfo">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeInfo
            <span class="apidocSignatureSpan">(typeOrId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getNodeList">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeList
            <span class="apidocSignatureSpan">(filter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.getType">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>getType
            <span class="apidocSignatureSpan">(type)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.init">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.installModule">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>installModule
            <span class="apidocSignatureSpan">(module)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.load">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>load
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.loadFlows">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>loadFlows
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.paletteEditorEnabled">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>paletteEditorEnabled
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.registerType">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>registerType
            <span class="apidocSignatureSpan">(nodeSet, type, constructor, opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.removeFlow">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>removeFlow
            <span class="apidocSignatureSpan">(id)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.setFlows">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>setFlows
            <span class="apidocSignatureSpan">(_config, type, muteLog)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.startFlows">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>startFlows
            <span class="apidocSignatureSpan">(type, diff, muteLog)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.stopFlows">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>stopFlows
            <span class="apidocSignatureSpan">(type, diff, muteLog)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.uninstallModule">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>uninstallModule
            <span class="apidocSignatureSpan">(module)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.nodes.updateFlow">
            function <span class="apidocSignatureSpan">node-red.nodes.</span>updateFlow
            <span class="apidocSignatureSpan">(id, newFlow)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.permissions">module node-red.permissions</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.permissions.hasPermission">
            function <span class="apidocSignatureSpan">node-red.permissions.</span>hasPermission
            <span class="apidocSignatureSpan">(userScope, permission)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.settings">module node-red.settings</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.available">
            function <span class="apidocSignatureSpan">node-red.settings.</span>available
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.delete">
            function <span class="apidocSignatureSpan">node-red.settings.</span>delete
            <span class="apidocSignatureSpan">(prop)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.get">
            function <span class="apidocSignatureSpan">node-red.settings.</span>get
            <span class="apidocSignatureSpan">(prop)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.init">
            function <span class="apidocSignatureSpan">node-red.settings.</span>init
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.load">
            function <span class="apidocSignatureSpan">node-red.settings.</span>load
            <span class="apidocSignatureSpan">(_storage)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.reset">
            function <span class="apidocSignatureSpan">node-red.settings.</span>reset
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.settings.set">
            function <span class="apidocSignatureSpan">node-red.settings.</span>set
            <span class="apidocSignatureSpan">(prop, value)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.strategies">module node-red.strategies</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.strategies.bearerStrategy">
            function <span class="apidocSignatureSpan">node-red.strategies.</span>bearerStrategy
            <span class="apidocSignatureSpan">(accessToken, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.strategies.clientPasswordStrategy">
            function <span class="apidocSignatureSpan">node-red.strategies.</span>clientPasswordStrategy
            <span class="apidocSignatureSpan">(clientId, clientSecret, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.strategies.init">
            function <span class="apidocSignatureSpan">node-red.strategies.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.strategies.passwordTokenExchange">
            function <span class="apidocSignatureSpan">node-red.strategies.</span>passwordTokenExchange
            <span class="apidocSignatureSpan">(client, username, password, scope, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-red.strategies.</span>anonymousStrategy</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.theme">module node-red.theme</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.theme.app">
            function <span class="apidocSignatureSpan">node-red.theme.</span>app
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.theme.context">
            function <span class="apidocSignatureSpan">node-red.theme.</span>context
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.theme.init">
            function <span class="apidocSignatureSpan">node-red.theme.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.theme.settings">
            function <span class="apidocSignatureSpan">node-red.theme.</span>settings
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.tokens">module node-red.tokens</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.tokens.create">
            function <span class="apidocSignatureSpan">node-red.tokens.</span>create
            <span class="apidocSignatureSpan">(user, client, scope)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.tokens.get">
            function <span class="apidocSignatureSpan">node-red.tokens.</span>get
            <span class="apidocSignatureSpan">(token)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.tokens.init">
            function <span class="apidocSignatureSpan">node-red.tokens.</span>init
            <span class="apidocSignatureSpan">(adminAuthSettings, _storage)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.tokens.revoke">
            function <span class="apidocSignatureSpan">node-red.tokens.</span>revoke
            <span class="apidocSignatureSpan">(token)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.ui">module node-red.ui</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.ui.editor">
            function <span class="apidocSignatureSpan">node-red.ui.</span>editor
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.ui.editorResources">
            function <span class="apidocSignatureSpan">node-red.ui.</span>editorResources
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.ui.ensureSlash">
            function <span class="apidocSignatureSpan">node-red.ui.</span>ensureSlash
            <span class="apidocSignatureSpan">(req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.ui.icon">
            function <span class="apidocSignatureSpan">node-red.ui.</span>icon
            <span class="apidocSignatureSpan">(req, res)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.ui.init">
            function <span class="apidocSignatureSpan">node-red.ui.</span>init
            <span class="apidocSignatureSpan">(runtime)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.users">module node-red.users</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.users.authenticate">
            function <span class="apidocSignatureSpan">node-red.users.</span>authenticate
            <span class="apidocSignatureSpan">(username, password)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.users.default">
            function <span class="apidocSignatureSpan">node-red.users.</span>default
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.users.get">
            function <span class="apidocSignatureSpan">node-red.users.</span>get
            <span class="apidocSignatureSpan">(username)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.users.init">
            function <span class="apidocSignatureSpan">node-red.users.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red.util">module node-red.util</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.cloneMessage">
            function <span class="apidocSignatureSpan">node-red.util.</span>cloneMessage
            <span class="apidocSignatureSpan">(msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.compareObjects">
            function <span class="apidocSignatureSpan">node-red.util.</span>compareObjects
            <span class="apidocSignatureSpan">(obj1, obj2)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.ensureBuffer">
            function <span class="apidocSignatureSpan">node-red.util.</span>ensureBuffer
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.ensureString">
            function <span class="apidocSignatureSpan">node-red.util.</span>ensureString
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.evaluateNodeProperty">
            function <span class="apidocSignatureSpan">node-red.util.</span>evaluateNodeProperty
            <span class="apidocSignatureSpan">(value, type, node, msg)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.generateId">
            function <span class="apidocSignatureSpan">node-red.util.</span>generateId
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.getMessageProperty">
            function <span class="apidocSignatureSpan">node-red.util.</span>getMessageProperty
            <span class="apidocSignatureSpan">(msg, expr)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.normalisePropertyExpression">
            function <span class="apidocSignatureSpan">node-red.util.</span>normalisePropertyExpression
            <span class="apidocSignatureSpan">(str)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red.util.setMessageProperty">
            function <span class="apidocSignatureSpan">node-red.util.</span>setMessageProperty
            <span class="apidocSignatureSpan">(msg, prop, value, createMissing)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red" id="apidoc.module.node-red">module node-red</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.Node" id="apidoc.element.node-red.Node">
        function <span class="apidocSignatureSpan">node-red.</span>Node
        <span class="apidocSignatureSpan">(n)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Node(n) {
    this.id = n.id;
    this.type = n.type;
    this.z = n.z;
    this._closeCallbacks = [];

    if (n.name) {
        this.name = n.name;
    }
    if (n._alias) {
        this._alias = n._alias;
    }
    this.updateWires(n.wires);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.init" id="apidoc.element.node-red.init">
        function <span class="apidocSignatureSpan">node-red.</span>init
        <span class="apidocSignatureSpan">(httpServer, userSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (httpServer, userSettings) {
    if (!userSettings) {
        userSettings = httpServer;
        httpServer = null;
    }

    if (!userSettings.SKIP_BUILD_CHECK) {
        checkVersion(userSettings);
        checkBuild();
    }

    if (!userSettings.coreNodesDir) {
        userSettings.coreNodesDir = path.resolve(path.join(__dirname,&#x22;..&#x22;,&#x22;nodes&#x22;));
    }

    if (userSettings.httpAdminRoot !== false) {
        runtime.init(userSettings,api);
        api.init(httpServer,runtime);
        apiEnabled = true;
    } else {
        runtime.init(userSettings);
        apiEnabled = false;
    }
    adminApp = runtime.adminApi.adminApp;
    nodeApp = runtime.nodeApp;
    server = runtime.adminApi.server;
    return;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.start" id="apidoc.element.node-red.start">
        function <span class="apidocSignatureSpan">node-red.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">start = function () {
    return runtime.start().then(function() {
        if (apiEnabled) {
            return api.start();
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    listenPath += settings.httpAdminRoot;
} else if (settings.httpStatic) {
    listenPath += &#x22;/&#x22;;
}
return listenPath;
}

RED.<span class="apidocCodeKeywordSpan">start</span>().then(function() {
if (settings.httpAdminRoot !== false || settings.httpNodeRoot !== false || settings.httpStatic) {
    server.on(&#x27;error&#x27;, function(err) {
        if (err.errno === &#x22;EADDRINUSE&#x22;) {
            RED.log.error(RED.log._(&#x22;server.unable-to-listen&#x22;, {listenpath:getListenPath()}));
            RED.log.error(RED.log._(&#x22;server.port-in-use&#x22;));
        } else {
            RED.log.error(RED.log._(&#x22;server.uncaught-exception&#x22;));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.stop" id="apidoc.element.node-red.stop">
        function <span class="apidocSignatureSpan">node-red.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stop = function () {
    return runtime.stop().then(function() {
        if (apiEnabled) {
            return api.stop();
        }
    })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else {
        util.log(err);
    }
    process.exit(1);
});

process.on(&#x27;SIGINT&#x27;, function () {
    RED.<span class="apidocCodeKeywordSpan">stop</span>();
    // TODO: need to allow nodes to close asynchronously before terminating the
    // process - ie, promises
    process.exit();
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.version" id="apidoc.element.node-red.version">
        function <span class="apidocSignatureSpan">node-red.</span>version
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getVersion() {
    if (!version) {
        version = require(path.join(__dirname,&#x22;..&#x22;,&#x22;..&#x22;,&#x22;package.json&#x22;)).version;
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        try {
            fs.statSync(path.join(__dirname,&#x22;..&#x22;,&#x22;..&#x22;,&#x22;.git&#x22;));
            version += &#x22;-git&#x22;;
        } catch(err) {
            // No git directory
        }
    }
    return version;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
nopt.invalidHandler = function(k,v,t) {
// TODO: console.log(k,v,t);
}

var parsedArgs = nopt(knownOpts,shortHands,process.argv,2)

if (parsedArgs.help) {
console.log(&#x22;Node-RED v&#x22;+RED.<span class="apidocCodeKeywordSpan">version</span>());
console.log(&#x22;Usage: node-red [-v] [-?] [--settings settings.js] [--userDir DIR]&#x22;);
console.log(&#x22;                [--port PORT] [--title TITLE] [flows.json]&#x22;);
console.log(&#x22;&#x22;);
console.log(&#x22;Options:&#x22;);
console.log(&#x22;  -p, --port     PORT  port to listen on&#x22;);
console.log(&#x22;  -s, --settings FILE  use specified settings file&#x22;);
console.log(&#x22;      --title    TITLE process window title&#x22;);
...</pre></li>
    </ul>
























































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.Node" id="apidoc.module.node-red.Node">module node-red.Node</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.Node.Node" id="apidoc.element.node-red.Node.Node">
        function <span class="apidocSignatureSpan">node-red.</span>Node
        <span class="apidocSignatureSpan">(n)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Node(n) {
    this.id = n.id;
    this.type = n.type;
    this.z = n.z;
    this._closeCallbacks = [];

    if (n.name) {
        this.name = n.name;
    }
    if (n._alias) {
        this._alias = n._alias;
    }
    this.updateWires(n.wires);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.super_" id="apidoc.element.node-red.Node.super_">
        function <span class="apidocSignatureSpan">node-red.Node.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.Node.prototype" id="apidoc.module.node-red.Node.prototype">module node-red.Node.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.Node.prototype._on" id="apidoc.element.node-red.Node.prototype._on">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>_on
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_on = function () {
    return;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Node.prototype._on = Node.prototype.on;

Node.prototype.on = function(event, callback) {
var node = this;
if (event == &#x22;close&#x22;) {
    this._closeCallbacks.push(callback);
} else {
    this.<span class="apidocCodeKeywordSpan">_on</span>(event, callback);
}
};

Node.prototype.close = function() {
var promises = [];
var node = this;
for (var i=0;i&#x3c;this._closeCallbacks.length;i++) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.close" id="apidoc.element.node-red.Node.prototype.close">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>close
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function () {
    var promises = [];
    var node = this;
    for (var i=0;i&#x3c;this._closeCallbacks.length;i++) {
        var callback = this._closeCallbacks[i];
        if (callback.length == 1) {
            promises.push(
                when.promise(function(resolve) {
                    callback.call(node, function() {
                        resolve();
                    });
                })
            );
        } else {
            callback.call(node);
        }
    }
    if (promises.length &#x3e; 0) {
        return when.settle(promises).then(function() {
            if (this._context) {
                 context.delete(this._alias||this.id,this.z);
            }
        });
    } else {
        if (this._context) {
             context.delete(this._alias||this.id,this.z);
        }
        return;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        var text = RED._(msg.text,{default:msg.text});
        if (!persistentNotifications.hasOwnProperty(notificationId)) {
            persistentNotifications[notificationId] = RED.notify(text,msg.type,msg.timeout === undefined,msg.timeout);
        } else {
            persistentNotifications[notificationId].update(text,msg.timeout);
        }
    } else if (persistentNotifications.hasOwnProperty(notificationId)) {
        persistentNotifications[notificationId].<span class="apidocCodeKeywordSpan">close</span>();
        delete persistentNotifications[notificationId];
    }
});
RED.comms.subscribe(&#x22;status/#&#x22;,function(topic,msg) {
    var parts = topic.split(&#x22;/&#x22;);
    var node = RED.nodes.node(parts[1]);
    if (node) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.context" id="apidoc.element.node-red.Node.prototype.context">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>context
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">context = function () {
    if (!this._context) {
         this._context = context.get(this._alias||this.id,this.z);
    }
    return this._context;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    // iconPath doesn&#x27;t exist
                }
            }
            res.sendFile(defaultIcon);
        }
    },
    editor: function(req,res) {
        res.send(Mustache.render(editorTemplate,theme.<span class="apidocCodeKeywordSpan">context</span>()));
    },
    editorResources: express.static(__dirname + &#x27;/../../public&#x27;)
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.error" id="apidoc.element.node-red.Node.prototype.error">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>error
        <span class="apidocSignatureSpan">(logMessage, msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function (logMessage, msg) {
    if (typeof logMessage != &#x27;boolean&#x27;) {
        logMessage = logMessage || &#x22;&#x22;;
    }
    log_helper(this, Log.ERROR, logMessage);
<span class="apidocCodeCommentSpan">    /* istanbul ignore else */
</span>    if (msg) {
        flows.handleError(this,logMessage,msg);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 - Better scope handling
 - Add security checks
 - small change to udp httpadmin
 - Fix comparison to &#x22;&#x22; in tcpin
 - Change scope of clients object
 - Works when connection is left open
 - First release of multi connection tcpget
 - Fix node.<span class="apidocCodeKeywordSpan">error</span>() not printing when passed false (#1037)
 - fix test for CSV array input
 - different test for Pi (rather than use serial port name)
 - Fix missing 0 handling for css node with array input


#### 0.15.2: Maintenance Release
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.log" id="apidoc.element.node-red.Node.prototype.log">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>log
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (msg) {
    log_helper(this, Log.INFO, msg);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// As we want to reserve -t for now, adding a shorthand to help so it
// doesn&#x27;t get treated as --title
&#x22;t&#x22;:[&#x22;--help&#x22;],
&#x22;u&#x22;:[&#x22;--userDir&#x22;],
&#x22;v&#x22;:[&#x22;--verbose&#x22;]
};
nopt.invalidHandler = function(k,v,t) {
// TODO: console.<span class="apidocCodeKeywordSpan">log</span>(k,v,t);
}

var parsedArgs = nopt(knownOpts,shortHands,process.argv,2)

if (parsedArgs.help) {
console.log(&#x22;Node-RED v&#x22;+RED.version());
console.log(&#x22;Usage: node-red [-v] [-?] [--settings settings.js] [--userDir DIR]&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.metric" id="apidoc.element.node-red.Node.prototype.metric">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>metric
        <span class="apidocSignatureSpan">(eventname, msg, metricValue)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metric = function (eventname, msg, metricValue) {
    if (typeof eventname === &#x22;undefined&#x22;) {
        return Log.metric();
    }
    var metrics = {};
    metrics.level = Log.METRIC;
    metrics.nodeid = this.id;
    metrics.event = &#x22;node.&#x22;+this.type+&#x22;.&#x22;+eventname;
    metrics.msgid = msg._msgid;
    metrics.value = metricValue;
    Log.log(metrics);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        .then(function() {
return i18n.registerMessageCatalog(&#x22;runtime&#x22;,path.resolve(path.join(__dirname,&#x22;locales&#x22;)),&#x22;runtime.json
&#x22;)
        })
        .then(function() { return storage.init(runtime)})
        .then(function() { return settings.load(storage)})
        .then(function() {

if (log.<span class="apidocCodeKeywordSpan">metric</span>()) {
    runtimeMetricInterval = setInterval(function() {
        reportMetrics();
    }, settings.runtimeMetricInterval||15000);
}
log.info(&#x22;\n\n&#x22;+log._(&#x22;runtime.welcome&#x22;)+&#x22;\n===================\n&#x22;);
if (settings.version) {
    log.info(log._(&#x22;runtime.version&#x22;,{component:&#x22;Node-RED&#x22;,version:&#x22;v&#x22;+settings.version}));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.on" id="apidoc.element.node-red.Node.prototype.on">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>on
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (event, callback) {
    var node = this;
    if (event == &#x22;close&#x22;) {
        this._closeCallbacks.push(callback);
    } else {
        this._on(event, callback);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    listenPath += &#x22;/&#x22;;
}
return listenPath;
}

RED.start().then(function() {
if (settings.httpAdminRoot !== false || settings.httpNodeRoot !== false || settings.httpStatic) {
    server.<span class="apidocCodeKeywordSpan">on</span>(&#x27;error&#x27;, function(err) {
        if (err.errno === &#x22;EADDRINUSE&#x22;) {
            RED.log.error(RED.log._(&#x22;server.unable-to-listen&#x22;, {listenpath:getListenPath()}));
            RED.log.error(RED.log._(&#x22;server.port-in-use&#x22;));
        } else {
            RED.log.error(RED.log._(&#x22;server.uncaught-exception&#x22;));
            if (err.stack) {
                RED.log.error(err.stack);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.receive" id="apidoc.element.node-red.Node.prototype.receive">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>receive
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">receive = function (msg) {
    if (!msg) {
        msg = {};
    }
    if (!msg._msgid) {
        msg._msgid = redUtil.generateId();
    }
    this.metric(&#x22;receive&#x22;,msg);
    try {
        this.emit(&#x22;input&#x22;, msg);
    } catch(err) {
        this.error(err,msg);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
}

RED.httpAdmin.post(&#x22;/inject/:id&#x22;, RED.auth.needsPermission(&#x22;inject.write&#x22;), function(req,res) {
    var node = RED.nodes.getNode(req.params.id);
    if (node != null) {
        try {
            node.<span class="apidocCodeKeywordSpan">receive</span>();
            res.sendStatus(200);
        } catch(err) {
            res.sendStatus(500);
            node.error(RED._(&#x22;inject.failed&#x22;,{error:err.toString()}));
        }
    } else {
        res.sendStatus(404);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.send" id="apidoc.element.node-red.Node.prototype.send">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>send
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (msg) {
    var msgSent = false;
    var node;

    if (msg === null || typeof msg === &#x22;undefined&#x22;) {
        return;
    } else if (!util.isArray(msg)) {
        if (this._wire) {
            // A single message and a single wire on output 0
            // TODO: pre-load flows.get calls - cannot do in constructor
            //       as not all nodes are defined at that point
            if (!msg._msgid) {
                msg._msgid = redUtil.generateId();
            }
            this.metric(&#x22;send&#x22;,msg);
            node = flows.get(this._wire);
<span class="apidocCodeCommentSpan">            /* istanbul ignore else */
</span>            if (node) {
                node.receive(msg);
            }
            return;
        } else {
            msg = [msg];
        }
    }

    var numOutputs = this.wires.length;

    // Build a list of send events so that all cloning is done before
    // any calls to node.receive
    var sendEvents = [];

    var sentMessageId = null;

    // for each output of node eg. [msgs to output 0, msgs to output 1, ...]
    for (var i = 0; i &#x3c; numOutputs; i++) {
        var wires = this.wires[i]; // wires leaving output i
        /* istanbul ignore else */
        if (i &#x3c; msg.length) {
            var msgs = msg[i]; // msgs going to output i
            if (msgs !== null &#x26;&#x26; typeof msgs !== &#x22;undefined&#x22;) {
                if (!util.isArray(msgs)) {
                    msgs = [msgs];
                }
                var k = 0;
                // for each recipent node of that output
                for (var j = 0; j &#x3c; wires.length; j++) {
                    node = flows.get(wires[j]); // node at end of wire j
                    if (node) {
                        // for each msg to send eg. [[m1, m2, ...], ...]
                        for (k = 0; k &#x3c; msgs.length; k++) {
                            var m = msgs[k];
                            if (m !== null &#x26;&#x26; m !== undefined) {
                                /* istanbul ignore else */
                                if (!sentMessageId) {
                                    sentMessageId = m._msgid;
                                }
                                if (msgSent) {
                                    var clonedmsg = redUtil.cloneMessage(m);
                                    sendEvents.push({n:node,m:clonedmsg});
                                } else {
                                    sendEvents.push({n:node,m:m});
                                    msgSent = true;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    /* istanbul ignore else */
    if (!sentMessageId) {
        sentMessageId = redUtil.generateId();
    }
    this.metric(&#x22;send&#x22;,{_msgid:sentMessageId});

    for (i=0;i&#x3c;sendEvents.length;i++) {
        var ev = sendEvents[i];
        /* istanbul ignore else */
        if (!ev.m._msgid) {
            ev.m._msgid = sentMessageId;
        }
        ev.n.receive(ev.m);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Look at other real nodes for some better ideas of what to do....
var msg = {};
msg.topic = this.topic;
msg.payload = &#x22;Hello world !&#x22;

// send out the message to the rest of the workspace.
// ... this message will get sent at startup so you may not see it in a debug node.
this.<span class="apidocCodeKeywordSpan">send</span>(msg);

// respond to inputs....
this.on(&#x27;input&#x27;, function (msg) {
    node.warn(&#x22;I saw a payload: &#x22;+msg.payload);
    // in this example just send it straight on... should process it here really
    node.send(msg);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.status" id="apidoc.element.node-red.Node.prototype.status">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>status
        <span class="apidocSignatureSpan">(status)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">status = function (status) {
    flows.handleStatus(this,status);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var id = req.params.id;
    var flow = redNodes.getFlow(id);
    if (flow) {
        log.audit({event: &#x22;flow.get&#x22;,id:id},req);
        res.json(flow);
    } else {
        log.audit({event: &#x22;flow.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.<span class="apidocCodeKeywordSpan">status</span>(404).end();
    }
},
post: function(req,res) {
    var flow = req.body;
    redNodes.addFlow(flow).then(function(id) {
        log.audit({event: &#x22;flow.add&#x22;,id:id},req);
        res.json({id:id});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.updateWires" id="apidoc.element.node-red.Node.prototype.updateWires">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>updateWires
        <span class="apidocSignatureSpan">(wires)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">updateWires = function (wires) {
    //console.log(&#x22;UPDATE&#x22;,this.id);
    this.wires = wires || [];
    delete this._wire;

    var wc = 0;
    this.wires.forEach(function(w) {
        wc+=w.length;
    });
    this._wireCount = wc;
    if (wc === 0) {
        // With nothing wired to the node, no-op send
        this.send = function(msg) {}
    } else {
        this.send = Node.prototype.send;
        if (this.wires.length === 1 &#x26;&#x26; this.wires[0].length === 1) {
            // Single wire, so we can shortcut the send when
            // a single message is sent
            this._wire = this.wires[0][0];
        }
    }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (n.name) {
    this.name = n.name;
}
if (n._alias) {
    this._alias = n._alias;
}
this.<span class="apidocCodeKeywordSpan">updateWires</span>(n.wires);
}

util.inherits(Node, EventEmitter);

Node.prototype.updateWires = function(wires) {
//console.log(&#x22;UPDATE&#x22;,this.id);
this.wires = wires || [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.Node.prototype.warn" id="apidoc.element.node-red.Node.prototype.warn">
        function <span class="apidocSignatureSpan">node-red.Node.prototype.</span>warn
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">warn = function (msg) {
    log_helper(this, Log.WARN, msg);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return res.sendStatus(401);
        }
        next();
    }
}

if (settings.httpAdminRoot !== false &#x26;&#x26; settings.httpAdminAuth) {
    RED.log.<span class="apidocCodeKeywordSpan">warn</span>(RED.log._(&#x22;server.httpadminauth-deprecated&#x22;));
    app.use(settings.httpAdminRoot, basicAuthMiddleware(settings.httpAdminAuth.user,settings.httpAdminAuth.pass));
}

if (settings.httpAdminRoot !== false) {
    app.use(settings.httpAdminRoot,RED.httpAdmin);
}
if (settings.httpNodeRoot !== false &#x26;&#x26; settings.httpNodeAuth) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.auth" id="apidoc.module.node-red.auth">module node-red.auth</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.auth.needsPermission" id="apidoc.element.node-red.auth.needsPermission">
        function <span class="apidocSignatureSpan">node-red.auth.</span>needsPermission
        <span class="apidocSignatureSpan">(permission)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function needsPermission(permission) {
    return function(req,res,next) {
        if (settings &#x26;&#x26; settings.adminAuth) {
            return passport.authenticate([&#x27;bearer&#x27;,&#x27;anon&#x27;],{ session: false })(req,res,function() {
                if (!req.user) {
                    return next();
                }
                if (permissions.hasPermission(req.authInfo.scope,permission)) {
                    return next();
                }
                log.audit({event: &#x22;permission.fail&#x22;, permissions: permission},req);
                return res.status(401).end();
            });
        } else {
            next();
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else if (this.cronjob != null) {
        this.cronjob.stop();
        if (RED.settings.verbose) { this.log(RED._(&#x22;inject.stopped&#x22;)); }
        delete this.cronjob;
    }
}

RED.httpAdmin.post(&#x22;/inject/:id&#x22;, RED.auth.<span class="apidocCodeKeywordSpan">needsPermission</span>(&#x22;inject.write
&#x22;), function(req,res) {
    var node = RED.nodes.getNode(req.params.id);
    if (node != null) {
        try {
            node.receive();
            res.sendStatus(200);
        } catch(err) {
            res.sendStatus(500);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.clients" id="apidoc.module.node-red.clients">module node-red.clients</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.clients.get" id="apidoc.element.node-red.clients.get">
        function <span class="apidocSignatureSpan">node-red.clients.</span>get
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (id) {
    for (var i=0;i&#x3c;clients.length;i++) {
        if (clients[i].id == id) {
            return when.resolve(clients[i]);
        }
    }
    return when.resolve(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.comms" id="apidoc.module.node-red.comms">module node-red.comms</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.comms.publish" id="apidoc.element.node-red.comms.publish">
        function <span class="apidocSignatureSpan">node-red.comms.</span>publish
        <span class="apidocSignatureSpan">(topic, data, retain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, data, retain) {
    if (server) {
        if (retain) {
            retained[topic] = data;
        } else {
            delete retained[topic];
        }
        lastSentTime = Date.now();
        activeConnections.forEach(function(conn) {
            publishTo(conn,topic,data);
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    promise = redNodes.installModule(node.module);
} else {
    log.audit({event: &#x22;nodes.install&#x22;,module:node.module,error:&#x22;invalid_request&#x22;},req);
    res.status(400).json({error:&#x22;invalid_request&#x22;, message:&#x22;Invalid request&#x22;});
    return;
}
promise.then(function(info) {
    comms.<span class="apidocCodeKeywordSpan">publish</span>(&#x22;node/added&#x22;,info.nodes,false);
    if (node.module) {
        log.audit({event: &#x22;nodes.install&#x22;,module:node.module},req);
        res.json(info);
    }
}).otherwise(function(err) {
    if (err.code === 404) {
        log.audit({event: &#x22;nodes.install&#x22;,module:node.module,error:&#x22;not_found&#x22;},req);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.context" id="apidoc.module.node-red.context">module node-red.context</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.context.clean" id="apidoc.element.node-red.context.clean">
        function <span class="apidocSignatureSpan">node-red.context.</span>clean
        <span class="apidocSignatureSpan">(flowConfig)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function clean(flowConfig) {
    var activeIds = {};
    var contextId;
    var node;
    for (var id in contexts) {
        if (contexts.hasOwnProperty(id)) {
            var idParts = id.split(&#x22;:&#x22;);
            if (!flowConfig.allNodes.hasOwnProperty(idParts[0])) {
                delete contexts[id];
            }
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.context.delete" id="apidoc.element.node-red.context.delete">
        function <span class="apidocSignatureSpan">node-red.context.</span>delete
        <span class="apidocSignatureSpan">(id, flowId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function deleteContext(id, flowId) {
    var contextId = id;
    if (flowId) {
        contextId = id+&#x22;:&#x22;+flowId;
    }
    delete contexts[contextId];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Flows
adminApp.get(&#x22;/flows&#x22;,needsPermission(&#x22;flows.read&#x22;),flows.get,errorHandler);
adminApp.post(&#x22;/flows&#x22;,needsPermission(&#x22;flows.write&#x22;),flows.post,errorHandler);

adminApp.get(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.read&#x22;),flow.get,errorHandler);
adminApp.post(&#x22;/flow&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.post,errorHandler);
adminApp.<span class="apidocCodeKeywordSpan">delete</span>(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.delete
,errorHandler);
adminApp.put(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.put,errorHandler);

// Nodes
adminApp.get(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.read&#x22;),nodes.getAll,errorHandler);
adminApp.post(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.write&#x22;),nodes.post,errorHandler);

adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getModule,errorHandler);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.context.get" id="apidoc.element.node-red.context.get">
        function <span class="apidocSignatureSpan">node-red.context.</span>get
        <span class="apidocSignatureSpan">(localId, flowId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getContext(localId, flowId) {
    var contextId = localId;
    if (flowId) {
        contextId = localId+&#x22;:&#x22;+flowId;
    }
    if (contexts.hasOwnProperty(contextId)) {
        return contexts[contextId];
    }
    var newContext = createContext(contextId);
    if (flowId) {
        newContext.flow = getContext(flowId);
        if (globalContext) {
            newContext.global = globalContext;
        }
    }
    contexts[contextId] = newContext;
    return newContext;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.context.init" id="apidoc.element.node-red.context.init">
        function <span class="apidocSignatureSpan">node-red.context.</span>init
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (settings) {
    globalContext = createContext(&#x22;global&#x22;,settings.functionGlobalContext || {});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.credentials" id="apidoc.module.node-red.credentials">module node-red.credentials</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.credentials.get" id="apidoc.element.node-red.credentials.get">
        function <span class="apidocSignatureSpan">node-red.credentials.</span>get
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (req, res) {
    // TODO: It should verify the given node id is of the type specified -
    //       but that would add a dependency from this module to the
    //       registry module that knows about node types.
    var nodeType = req.params.type;
    var nodeID = req.params.id;
    log.audit({event: &#x22;credentials.get&#x22;,type:nodeType,id:nodeID},req);
    var credentials = api.getCredentials(nodeID);
    if (!credentials) {
        res.json({});
        return;
    }
    var definition = api.getCredentialDefinition(nodeType);

    var sendCredentials = {};
    for (var cred in definition) {
        if (definition.hasOwnProperty(cred)) {
            if (definition[cred].type == &#x22;password&#x22;) {
                var key = &#x27;has_&#x27; + cred;
                sendCredentials[key] = credentials[cred] != null &#x26;&#x26; credentials[cred] !== &#x27;&#x27;;
                continue;
            }
            sendCredentials[cred] = credentials[cred] || &#x27;&#x27;;
        }
    }
    res.json(sendCredentials);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.credentials.init" id="apidoc.element.node-red.credentials.init">
        function <span class="apidocSignatureSpan">node-red.credentials.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    log = runtime.log;
    api = runtime.nodes;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.flow" id="apidoc.module.node-red.flow">module node-red.flow</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.flow.delete" id="apidoc.element.node-red.flow.delete">
        function <span class="apidocSignatureSpan">node-red.flow.</span>delete
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">delete = function (req, res) {
    var id = req.params.id;
    try {
        redNodes.removeFlow(id).then(function() {
            log.audit({event: &#x22;flow.remove&#x22;,id:id},req);
            res.status(204).end();
        })
    } catch(err) {
        if (err.code === 404) {
            log.audit({event: &#x22;flow.remove&#x22;,id:id,error:&#x22;not_found&#x22;},req);
            res.status(404).end();
        } else {
            log.audit({event: &#x22;flow.remove&#x22;,id:id,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
            res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Flows
adminApp.get(&#x22;/flows&#x22;,needsPermission(&#x22;flows.read&#x22;),flows.get,errorHandler);
adminApp.post(&#x22;/flows&#x22;,needsPermission(&#x22;flows.write&#x22;),flows.post,errorHandler);

adminApp.get(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.read&#x22;),flow.get,errorHandler);
adminApp.post(&#x22;/flow&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.post,errorHandler);
adminApp.<span class="apidocCodeKeywordSpan">delete</span>(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.delete
,errorHandler);
adminApp.put(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.put,errorHandler);

// Nodes
adminApp.get(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.read&#x22;),nodes.getAll,errorHandler);
adminApp.post(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.write&#x22;),nodes.post,errorHandler);

adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getModule,errorHandler);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flow.get" id="apidoc.element.node-red.flow.get">
        function <span class="apidocSignatureSpan">node-red.flow.</span>get
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (req, res) {
    var id = req.params.id;
    var flow = redNodes.getFlow(id);
    if (flow) {
        log.audit({event: &#x22;flow.get&#x22;,id:id},req);
        res.json(flow);
    } else {
        log.audit({event: &#x22;flow.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.status(404).end();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flow.init" id="apidoc.element.node-red.flow.init">
        function <span class="apidocSignatureSpan">node-red.flow.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    settings = runtime.settings;
    redNodes = runtime.nodes;
    log = runtime.log;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flow.post" id="apidoc.element.node-red.flow.post">
        function <span class="apidocSignatureSpan">node-red.flow.</span>post
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">post = function (req, res) {
    var flow = req.body;
    redNodes.addFlow(flow).then(function(id) {
        log.audit({event: &#x22;flow.add&#x22;,id:id},req);
        res.json({id:id});
    }).otherwise(function(err) {
        log.audit({event: &#x22;flow.add&#x22;,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
        res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
    })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
adminApp.use(bodyParser.urlencoded({limit:maxApiRequestSize,extended:true}));

adminApp.get(&#x22;/auth/login&#x22;,auth.login,errorHandler);

if (settings.adminAuth) {
    //TODO: all passport references ought to be in ./auth
    adminApp.use(passport.initialize());
    adminApp.<span class="apidocCodeKeywordSpan">post</span>(&#x22;/auth/token&#x22;,
        auth.ensureClientSecret,
        auth.authenticateClient,
        auth.getToken,
        auth.errorHandler
    );
    adminApp.post(&#x22;/auth/revoke&#x22;,needsPermission(&#x22;&#x22;),auth.revoke,errorHandler);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flow.put" id="apidoc.element.node-red.flow.put">
        function <span class="apidocSignatureSpan">node-red.flow.</span>put
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">put = function (req, res) {
    var id = req.params.id;
    var flow = req.body;
    try {
        redNodes.updateFlow(id,flow).then(function() {
            log.audit({event: &#x22;flow.update&#x22;,id:id},req);
            res.json({id:id});
        }).otherwise(function(err) {
            log.audit({event: &#x22;flow.update&#x22;,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
            res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
        })
    } catch(err) {
        if (err.code === 404) {
            log.audit({event: &#x22;flow.update&#x22;,id:id,error:&#x22;not_found&#x22;},req);
            res.status(404).end();
        } else {
            log.audit({event: &#x22;flow.update&#x22;,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
            res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Flows
adminApp.get(&#x22;/flows&#x22;,needsPermission(&#x22;flows.read&#x22;),flows.get,errorHandler);
adminApp.post(&#x22;/flows&#x22;,needsPermission(&#x22;flows.write&#x22;),flows.post,errorHandler);

adminApp.get(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.read&#x22;),flow.get,errorHandler);
adminApp.post(&#x22;/flow&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.post,errorHandler);
adminApp.delete(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.delete,errorHandler);
adminApp.<span class="apidocCodeKeywordSpan">put</span>(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.put,
errorHandler);

// Nodes
adminApp.get(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.read&#x22;),nodes.getAll,errorHandler);
adminApp.post(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.write&#x22;),nodes.post,errorHandler);

adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getModule,errorHandler);
adminApp.put(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.write&#x22;),nodes.putModule,errorHandler);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.flows" id="apidoc.module.node-red.flows">module node-red.flows</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.flows.get" id="apidoc.element.node-red.flows.get">
        function <span class="apidocSignatureSpan">node-red.flows.</span>get
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (req, res) {
    var version = req.get(&#x22;Node-RED-API-Version&#x22;)||&#x22;v1&#x22;;
    if (version === &#x22;v1&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v1&#x22;},req);
        res.json(redNodes.getFlows().flows);
    } else if (version === &#x22;v2&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v2&#x22;},req);
        res.json(redNodes.getFlows());
    } else {
        log.audit({event: &#x22;flows.get&#x22;,version:version,error:&#x22;invalid_api_version&#x22;},req);
        res.status(400).json({code:&#x22;invalid_api_version&#x22;, message:&#x22;Invalid API Version requested&#x22;});
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flows.init" id="apidoc.element.node-red.flows.init">
        function <span class="apidocSignatureSpan">node-red.flows.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    settings = runtime.settings;
    redNodes = runtime.nodes;
    log = runtime.log;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.flows.post" id="apidoc.element.node-red.flows.post">
        function <span class="apidocSignatureSpan">node-red.flows.</span>post
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">post = function (req, res) {
    var version = req.get(&#x22;Node-RED-API-Version&#x22;)||&#x22;v1&#x22;;
    var flows = req.body;
    var deploymentType = req.get(&#x22;Node-RED-Deployment-Type&#x22;)||&#x22;full&#x22;;
    log.audit({event: &#x22;flows.set&#x22;,type:deploymentType,version:version},req);
    if (deploymentType === &#x27;reload&#x27;) {
        redNodes.loadFlows().then(function() {
            res.status(204).end();
        }).otherwise(function(err) {
            log.warn(log._(&#x22;api.flows.error-reload&#x22;,{message:err.message}));
            log.warn(err.stack);
            res.status(500).json({error:&#x22;unexpected_error&#x22;, message:err.message});
        });
    } else {
        var flowConfig = flows;
        if (version === &#x22;v2&#x22;) {
            flowConfig = flows.flows;
            if (flows.hasOwnProperty(&#x27;rev&#x27;)) {
                var currentVersion = redNodes.getFlows().rev;
                if (currentVersion !== flows.rev) {
                    //TODO: log warning
                    return res.status(409).json({code:&#x22;version_mismatch&#x22;});
                }
            }
        } else if (version !== &#x27;v1&#x27;) {
            log.audit({event: &#x22;flows.set&#x22;,version:version,error:&#x22;invalid_api_version&#x22;},req);
            res.status(400).json({code:&#x22;invalid_api_version&#x22;, message:&#x22;Invalid API Version requested&#x22;});
        }
        redNodes.setFlows(flowConfig,deploymentType).then(function(flowId) {
            if (version === &#x22;v1&#x22;) {
                res.status(204).end();
            } else if (version === &#x22;v2&#x22;) {
                res.json({rev:flowId});
            } else {
                // TODO: invalid version
            }
        }).otherwise(function(err) {
            log.warn(log._(&#x22;api.flows.error-save&#x22;,{message:err.message}));
            log.warn(err.stack);
            res.status(500).json({error:&#x22;unexpected_error&#x22;, message:err.message});
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
adminApp.use(bodyParser.urlencoded({limit:maxApiRequestSize,extended:true}));

adminApp.get(&#x22;/auth/login&#x22;,auth.login,errorHandler);

if (settings.adminAuth) {
    //TODO: all passport references ought to be in ./auth
    adminApp.use(passport.initialize());
    adminApp.<span class="apidocCodeKeywordSpan">post</span>(&#x22;/auth/token&#x22;,
        auth.ensureClientSecret,
        auth.authenticateClient,
        auth.getToken,
        auth.errorHandler
    );
    adminApp.post(&#x22;/auth/revoke&#x22;,needsPermission(&#x22;&#x22;),auth.revoke,errorHandler);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.i18n" id="apidoc.module.node-red.i18n">module node-red.i18n</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.i18n._" id="apidoc.element.node-red.i18n._">
        function <span class="apidocSignatureSpan">node-red.i18n.</span>_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_ = function () {
    //var opts = {};
    //if (def) {
    //    opts.defaultValue = def;
    //}
    //console.log(arguments);
    return i18n.t.apply(null,arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return res.sendStatus(401);
        }
        next();
    }
}

if (settings.httpAdminRoot !== false &#x26;&#x26; settings.httpAdminAuth) {
    RED.log.warn(RED.log.<span class="apidocCodeKeywordSpan">_</span>(&#x22;server.httpadminauth-deprecated&#x22;));
    app.use(settings.httpAdminRoot, basicAuthMiddleware(settings.httpAdminAuth.user,settings.httpAdminAuth.pass));
}

if (settings.httpAdminRoot !== false) {
    app.use(settings.httpAdminRoot,RED.httpAdmin);
}
if (settings.httpNodeRoot !== false &#x26;&#x26; settings.httpNodeAuth) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.i18n.catalog" id="apidoc.element.node-red.i18n.catalog">
        function <span class="apidocSignatureSpan">node-red.i18n.</span>catalog
        <span class="apidocSignatureSpan">(namespace, lang)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getCatalog(namespace, lang) {
    var result = null;
    if (resourceCache.hasOwnProperty(namespace)) {
        result = resourceCache[namespace][lang];
        if (!result) {
            var langParts = lang.split(&#x22;-&#x22;);
            if (langParts.length == 2) {
                result = resourceCache[namespace][langParts[0]];
            }
            if (!result) {
                return resourceCache[namespace][defaultLang];
            }
        }
    }
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    },
    get: function(req,res) {
        var namespace = req.params[0];
        namespace = namespace.replace(/\.json$/,&#x22;&#x22;);
        var lang = determineLangFromHeaders(req.acceptsLanguages() || []);
        var prevLang = i18n.i.lng();
        i18n.i.setLng(lang, function(){
            var catalog = i18n.<span class="apidocCodeKeywordSpan">catalog</span>(namespace,lang);
            res.json(catalog||{});
        });
        i18n.i.setLng(prevLang);
    },
    determineLangFromHeaders: determineLangFromHeaders
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.i18n.init" id="apidoc.element.node-red.i18n.init">
        function <span class="apidocSignatureSpan">node-red.i18n.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init() {
    return when.promise(function(resolve,reject) {
        i18n.backend(MessageFileLoader);
        i18n.init({
            ns: {
                namespaces: [],
                defaultNs: &#x22;runtime&#x22;
            },
            fallbackLng: [defaultLang]
        },function() {
            resolve();
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.i18n.registerMessageCatalog" id="apidoc.element.node-red.i18n.registerMessageCatalog">
        function <span class="apidocSignatureSpan">node-red.i18n.</span>registerMessageCatalog
        <span class="apidocSignatureSpan">(namespace, dir, file)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function registerMessageCatalog(namespace, dir, file) {
    return when.promise(function(resolve,reject) {
        resourceMap[namespace] = { basedir:dir, file:file};
        i18n.loadNamespace(namespace,function() {
            resolve();
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
    return version;
}

function start() {
    return i18n.init()
        .then(function() {
return i18n.<span class="apidocCodeKeywordSpan">registerMessageCatalog</span>(&#x22;runtime&#x22;,path.resolve(path.join(__dirname
,&#x22;locales&#x22;)),&#x22;runtime.json&#x22;)
        })
        .then(function() { return storage.init(runtime)})
        .then(function() { return settings.load(storage)})
        .then(function() {

if (log.metric()) {
    runtimeMetricInterval = setInterval(function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.i18n.registerMessageCatalogs" id="apidoc.element.node-red.i18n.registerMessageCatalogs">
        function <span class="apidocSignatureSpan">node-red.i18n.</span>registerMessageCatalogs
        <span class="apidocSignatureSpan">(catalogs)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function registerMessageCatalogs(catalogs) {
    var promises = catalogs.map(function(catalog) {
        return registerMessageCatalog(catalog.namespace,catalog.dir,catalog.file);
    });
    return when.settle(promises);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        // Error Handler
        //adminApp.use(errorHandler);
    }
}
function start() {
    var catalogPath = path.resolve(path.join(__dirname,&#x22;locales&#x22;));
    return i18n.<span class="apidocCodeKeywordSpan">registerMessageCatalogs</span>([
        {namespace: &#x22;editor&#x22;,   dir: catalogPath, file:&#x22;editor.json&#x22;},
        {namespace: &#x22;jsonata&#x22;,  dir: catalogPath, file:&#x22;jsonata.json&#x22;},
        {namespace: &#x22;infotips&#x22;, dir: catalogPath, file:&#x22;infotips.json&#x22;}
    ]).then(function(){
        comms.start();
    });
}
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.index" id="apidoc.module.node-red.index">module node-red.index</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.index.init" id="apidoc.element.node-red.index.init">
        function <span class="apidocSignatureSpan">node-red.index.</span>init
        <span class="apidocSignatureSpan">(_server, _runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(_server, _runtime) {
    server = _server;
    runtime = _runtime;
    var settings = runtime.settings;
    i18n = runtime.i18n;
    log = runtime.log;
    if (settings.httpAdminRoot !== false) {
        comms.init(server,runtime);
        adminApp = express();
        auth.init(runtime);
        credentials.init(runtime);
        flows.init(runtime);
        flow.init(runtime);
        info.init(runtime);
        library.init(adminApp,runtime);
        locales.init(runtime);
        nodes.init(runtime);

        // Editor
        if (!settings.disableEditor) {
            ui.init(runtime);
            var editorApp = express();
            if (settings.requireHttps === true) {
                editorApp.enable(&#x27;trust proxy&#x27;);
                editorApp.use(function (req, res, next) {
                    if (req.secure) {
                        next();
                    } else {
                        res.redirect(&#x27;https://&#x27; + req.headers.host + req.originalUrl);
                    }
                });
            }
            editorApp.get(&#x22;/&#x22;,ensureRuntimeStarted,ui.ensureSlash,ui.editor);
            editorApp.get(&#x22;/icons/:icon&#x22;,ui.icon);
            theme.init(runtime);
            if (settings.editorTheme) {
                editorApp.use(&#x22;/theme&#x22;,theme.app());
            }
            editorApp.use(&#x22;/&#x22;,ui.editorResources);
            adminApp.use(editorApp);
        }
        var maxApiRequestSize = settings.apiMaxLength || &#x27;5mb&#x27;;
        adminApp.use(bodyParser.json({limit:maxApiRequestSize}));
        adminApp.use(bodyParser.urlencoded({limit:maxApiRequestSize,extended:true}));

        adminApp.get(&#x22;/auth/login&#x22;,auth.login,errorHandler);

        if (settings.adminAuth) {
            //TODO: all passport references ought to be in ./auth
            adminApp.use(passport.initialize());
            adminApp.post(&#x22;/auth/token&#x22;,
                auth.ensureClientSecret,
                auth.authenticateClient,
                auth.getToken,
                auth.errorHandler
            );
            adminApp.post(&#x22;/auth/revoke&#x22;,needsPermission(&#x22;&#x22;),auth.revoke,errorHandler);
        }
        if (settings.httpAdminCors) {
            var corsHandler = cors(settings.httpAdminCors);
            adminApp.use(corsHandler);
        }

        // Flows
        adminApp.get(&#x22;/flows&#x22;,needsPermission(&#x22;flows.read&#x22;),flows.get,errorHandler);
        adminApp.post(&#x22;/flows&#x22;,needsPermission(&#x22;flows.write&#x22;),flows.post,errorHandler);

        adminApp.get(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.read&#x22;),flow.get,errorHandler);
        adminApp.post(&#x22;/flow&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.post,errorHandler);
        adminApp.delete(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.delete,errorHandler);
        adminApp.put(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.put,errorHandler);

        // Nodes
        adminApp.get(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.read&#x22;),nodes.getAll,errorHandler);
        adminApp.post(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.write&#x22;),nodes.post,errorHandler);

        adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getModule,errorHandler);
        adminApp.put(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.write&#x22;),nodes.putModule,errorHandler);
        adminApp.delete(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.write&#x22;),nodes.delete,errorHandler);

        adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)\/([^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getSet,errorHandler);
        adminApp.put(/\/nodes\/((@[^\/]+\/)?[^\/]+)\/([^\/]+)$/,needsPermission(&#x22;nodes.write&#x22;),nodes.putSet,errorHandler);

        adminApp.get(&#x27;/credentials/:type/:id&#x27;, needsPermission(&#x22;credentials.read&#x22;),credentials.get,errorHandler);

        adminApp.get(/locales\/(.+)\/?$/,locales.get,errorHandler);

        // Library
        adminApp.post(new RegExp(&#x22;/library/flows\/(.*)&#x22;),needsPermission(&#x22;library.write&#x22;),library.post,errorHandler);
        adminApp.get(&#x22;/library/flows&#x22;,needsPermission(&#x22;library.read&#x22;),library.getAll,errorHandler);
        adminApp.get(new RegExp(&#x22;/library/flows ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.index.start" id="apidoc.element.node-red.index.start">
        function <span class="apidocSignatureSpan">node-red.index.</span>start
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function start() {
    var catalogPath = path.resolve(path.join(__dirname,&#x22;locales&#x22;));
    return i18n.registerMessageCatalogs([
        {namespace: &#x22;editor&#x22;,   dir: catalogPath, file:&#x22;editor.json&#x22;},
        {namespace: &#x22;jsonata&#x22;,  dir: catalogPath, file:&#x22;jsonata.json&#x22;},
        {namespace: &#x22;infotips&#x22;, dir: catalogPath, file:&#x22;infotips.json&#x22;}
    ]).then(function(){
        comms.start();
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    listenPath += settings.httpAdminRoot;
} else if (settings.httpStatic) {
    listenPath += &#x22;/&#x22;;
}
return listenPath;
}

RED.<span class="apidocCodeKeywordSpan">start</span>().then(function() {
if (settings.httpAdminRoot !== false || settings.httpNodeRoot !== false || settings.httpStatic) {
    server.on(&#x27;error&#x27;, function(err) {
        if (err.errno === &#x22;EADDRINUSE&#x22;) {
            RED.log.error(RED.log._(&#x22;server.unable-to-listen&#x22;, {listenpath:getListenPath()}));
            RED.log.error(RED.log._(&#x22;server.port-in-use&#x22;));
        } else {
            RED.log.error(RED.log._(&#x22;server.uncaught-exception&#x22;));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.index.stop" id="apidoc.element.node-red.index.stop">
        function <span class="apidocSignatureSpan">node-red.index.</span>stop
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function stop() {
    comms.stop();
    return when.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else {
        util.log(err);
    }
    process.exit(1);
});

process.on(&#x27;SIGINT&#x27;, function () {
    RED.<span class="apidocCodeKeywordSpan">stop</span>();
    // TODO: need to allow nodes to close asynchronously before terminating the
    // process - ie, promises
    process.exit();
});
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.info" id="apidoc.module.node-red.info">module node-red.info</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.info.init" id="apidoc.element.node-red.info.init">
        function <span class="apidocSignatureSpan">node-red.info.</span>init
        <span class="apidocSignatureSpan">(_runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (_runtime) {
    runtime = _runtime;
    settings = runtime.settings;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.info.settings" id="apidoc.element.node-red.info.settings">
        function <span class="apidocSignatureSpan">node-red.info.</span>settings
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">settings = function (req, res) {
    var safeSettings = {
        httpNodeRoot: settings.httpNodeRoot||&#x22;/&#x22;,
        version: settings.version,
        user: req.user
    }

    var themeSettings = theme.settings();
    if (themeSettings) {
        safeSettings.editorTheme = themeSettings;
    }

    if (util.isArray(settings.paletteCategories)) {
        safeSettings.paletteCategories = settings.paletteCategories;
    }

    if (settings.flowFilePretty) {
        safeSettings.flowFilePretty = settings.flowFilePretty;
    }

    if (!runtime.nodes.paletteEditorEnabled()) {
        safeSettings.editorTheme = safeSettings.editorTheme || {};
        safeSettings.editorTheme.palette = safeSettings.editorTheme.palette || {};
        safeSettings.editorTheme.palette.editable = false;
    }

    res.json(safeSettings);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    settings: function(req,res) {
var safeSettings = {
    httpNodeRoot: settings.httpNodeRoot||&#x22;/&#x22;,
    version: settings.version,
    user: req.user
}

var themeSettings = theme.<span class="apidocCodeKeywordSpan">settings</span>();
if (themeSettings) {
    safeSettings.editorTheme = themeSettings;
}

if (util.isArray(settings.paletteCategories)) {
    safeSettings.paletteCategories = settings.paletteCategories;
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.library" id="apidoc.module.node-red.library">module node-red.library</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.library.register" id="apidoc.element.node-red.library.register">
        function <span class="apidocSignatureSpan">node-red.library.</span>register
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createLibrary(type) {
    if (redApp) {
        redApp.get(new RegExp(&#x22;/library/&#x22;+type+&#x22;($|\/(.*))&#x22;),needsPermission(&#x22;library.read&#x22;),function(req,res) {
            var path = req.params[1]||&#x22;&#x22;;
            storage.getLibraryEntry(type,path).then(function(result) {
                log.audit({event: &#x22;library.get&#x22;,type:type},req);
                if (typeof result === &#x22;string&#x22;) {
                    res.writeHead(200, {&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;});
                    res.write(result);
                    res.end();
                } else {
                    res.json(result);
                }
            }).otherwise(function(err) {
                if (err) {
                    log.warn(log._(&#x22;api.library.error-load-entry&#x22;,{path:path,message:err.toString()}));
                    if (err.code === &#x27;forbidden&#x27;) {
                        log.audit({event: &#x22;library.get&#x22;,type:type,error:&#x22;forbidden&#x22;},req);
                        res.status(403).end();
                        return;
                    }
                }
                log.audit({event: &#x22;library.get&#x22;,type:type,error:&#x22;not_found&#x22;},req);
                res.status(404).end();
            });
        });

        redApp.post(new RegExp(&#x22;/library/&#x22;+type+&#x22;\/(.*)&#x22;),needsPermission(&#x22;library.write&#x22;),function(req,res) {
            var path = req.params[0];
            var meta = req.body;
            var text = meta.text;
            delete meta.text;

            storage.saveLibraryEntry(type,path,meta,text).then(function() {
                log.audit({event: &#x22;library.set&#x22;,type:type},req);
                res.status(204).end();
            }).otherwise(function(err) {
                log.warn(log._(&#x22;api.library.error-save-entry&#x22;,{path:path,message:err.toString()}));
                    if (err.code === &#x27;forbidden&#x27;) {
                    log.audit({event: &#x22;library.set&#x22;,type:type,error:&#x22;forbidden&#x22;},req);
                    res.status(403).end();
                    return;
                }
                log.audit({event: &#x22;library.set&#x22;,type:type,error:&#x22;unexpected_error&#x22;,message:err.toString()},req);
                res.status(500).json({error:&#x22;unexpected_error&#x22;, message:err.toString()});
            });
        });
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        } catch(err) {
            // eg SyntaxError - which v8 doesn&#x27;t include line number information
            // so we can&#x27;t do better than this
            this.error(err);
        }
    }
    RED.nodes.registerType(&#x22;function&#x22;,FunctionNode);
    RED.library.<span class="apidocCodeKeywordSpan">register</span>(&#x22;functions&#x22;);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.locales" id="apidoc.module.node-red.locales">module node-red.locales</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.locales.determineLangFromHeaders" id="apidoc.element.node-red.locales.determineLangFromHeaders">
        function <span class="apidocSignatureSpan">node-red.locales.</span>determineLangFromHeaders
        <span class="apidocSignatureSpan">(acceptedLanguages)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function determineLangFromHeaders(acceptedLanguages){
    var lang = i18n.defaultLang;
    acceptedLanguages = acceptedLanguages || [];
    for (var i=0;i&#x3c;acceptedLanguages.length;i++){
        if (supportedLangs.indexOf(acceptedLanguages[i]) !== -1){
            lang = acceptedLanguages[i];
            break;
        // check the language without the country code
        } else if (supportedLangs.indexOf(acceptedLanguages[i].split(&#x22;-&#x22;)[0]) !== -1) {
            lang = acceptedLanguages[i].split(&#x22;-&#x22;)[0];
            break;
        }
    }
    return lang;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    settings = runtime.settings;
},
getAll: function(req,res) {
    if (req.get(&#x22;accept&#x22;) == &#x22;application/json&#x22;) {
        log.audit({event: &#x22;nodes.list.get&#x22;},req);
        res.json(redNodes.getNodeList());
    } else {
        var lang = locales.<span class="apidocCodeKeywordSpan">determineLangFromHeaders</span>(req.acceptsLanguages());
        log.audit({event: &#x22;nodes.configs.get&#x22;},req);
        res.send(redNodes.getNodeConfigs(lang));
    }
},

post: function(req,res) {
    if (!settings.available()) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.locales.get" id="apidoc.element.node-red.locales.get">
        function <span class="apidocSignatureSpan">node-red.locales.</span>get
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (req, res) {
    var namespace = req.params[0];
    namespace = namespace.replace(/\.json$/,&#x22;&#x22;);
    var lang = determineLangFromHeaders(req.acceptsLanguages() || []);
    var prevLang = i18n.i.lng();
    i18n.i.setLng(lang, function(){
        var catalog = i18n.catalog(namespace,lang);
        res.json(catalog||{});
    });
    i18n.i.setLng(prevLang);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.locales.init" id="apidoc.element.node-red.locales.init">
        function <span class="apidocSignatureSpan">node-red.locales.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    i18n = runtime.i18n;
    initSupportedLangs();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.localfilesystem" id="apidoc.module.node-red.localfilesystem">module node-red.localfilesystem</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.getCredentials" id="apidoc.element.node-red.localfilesystem.getCredentials">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getCredentials
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCredentials = function () {
    return readFile(credentialsFile,credentialsFileBackup,{},&#x27;credentials&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    get: function (req, res) {
// TODO: It should verify the given node id is of the type specified -
//       but that would add a dependency from this module to the
//       registry module that knows about node types.
var nodeType = req.params.type;
var nodeID = req.params.id;
log.audit({event: &#x22;credentials.get&#x22;,type:nodeType,id:nodeID},req);
var credentials = api.<span class="apidocCodeKeywordSpan">getCredentials</span>(nodeID);
if (!credentials) {
    res.json({});
    return;
}
var definition = api.getCredentialDefinition(nodeType);

var sendCredentials = {};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.getFlows" id="apidoc.element.node-red.localfilesystem.getFlows">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getFlows
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getFlows = function () {
    if (!initialFlowLoadComplete) {
        initialFlowLoadComplete = true;
        log.info(log._(&#x22;storage.localfilesystem.user-dir&#x22;,{path:settings.userDir}));
        log.info(log._(&#x22;storage.localfilesystem.flows-file&#x22;,{path:flowsFullPath}));
    }
    return readFile(flowsFullPath,flowsFileBackup,[],&#x27;flow&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    redNodes = runtime.nodes;
    log = runtime.log;
},
get: function(req,res) {
    var version = req.get(&#x22;Node-RED-API-Version&#x22;)||&#x22;v1&#x22;;
    if (version === &#x22;v1&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v1&#x22;},req);
        res.json(redNodes.<span class="apidocCodeKeywordSpan">getFlows</span>().flows);
    } else if (version === &#x22;v2&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v2&#x22;},req);
        res.json(redNodes.getFlows());
    } else {
        log.audit({event: &#x22;flows.get&#x22;,version:version,error:&#x22;invalid_api_version&#x22;},req);
        res.status(400).json({code:&#x22;invalid_api_version&#x22;, message:&#x22;Invalid API Version requested&#x22;});
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.getLibraryEntry" id="apidoc.element.node-red.localfilesystem.getLibraryEntry">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getLibraryEntry
        <span class="apidocSignatureSpan">(type, path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getLibraryEntry = function (type, path) {
    var root = fspath.join(libDir,type);
    var rootPath = fspath.join(libDir,type,path);

    // don&#x27;t create the folder if it does not exist - we are only reading....
    return nodeFn.call(fs.lstat, rootPath).then(function(stats) {
        if (stats.isFile()) {
            return getFileBody(root,path);
        }
        if (path.substr(-1) == &#x27;/&#x27;) {
            path = path.substr(0,path.length-1);
        }
        return nodeFn.call(fs.readdir, rootPath).then(function(fns) {
            var dirs = [];
            var files = [];
            fns.sort().filter(function(fn) {
                var fullPath = fspath.join(path,fn);
                var absoluteFullPath = fspath.join(root,fullPath);
                if (fn[0] != &#x22;.&#x22;) {
                    var stats = fs.lstatSync(absoluteFullPath);
                    if (stats.isDirectory()) {
                        dirs.push(fn);
                    } else {
                        var meta = getFileMeta(root,fullPath);
                        meta.fn = fn;
                        files.push(meta);
                    }
                }
            });
            return dirs.concat(files);
        });
    }).otherwise(function(err) {
        // if path is empty, then assume it was a folder, return empty
        if (path === &#x22;&#x22;){
            return [];
        }

        // if path ends with slash, it was a folder
        // so return empty
        if (path.substr(-1) == &#x27;/&#x27;) {
            return [];
        }

        // else path was specified, but did not exist,
        // check for path.json as an alternative if flows
        if (type === &#x22;flows&#x22; &#x26;&#x26; !/\.json$/.test(path)) {
            return localfilesystem.getLibraryEntry(type,path+&#x22;.json&#x22;)
            .otherwise(function(e) {
                throw err;
            });
        } else {
            throw err;
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var log;
var needsPermission = require(&#x22;./auth&#x22;).needsPermission;

function createLibrary(type) {
if (redApp) {
    redApp.get(new RegExp(&#x22;/library/&#x22;+type+&#x22;($|\/(.*))&#x22;),needsPermission(&#x22;library.read&#x22;),function(
req,res) {
        var path = req.params[1]||&#x22;&#x22;;
        storage.<span class="apidocCodeKeywordSpan">getLibraryEntry</span>(type,path).then(function(result) {
            log.audit({event: &#x22;library.get&#x22;,type:type},req);
            if (typeof result === &#x22;string&#x22;) {
                res.writeHead(200, {&#x27;Content-Type&#x27;: &#x27;text/plain&#x27;});
                res.write(result);
                res.end();
            } else {
                res.json(result);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.getSessions" id="apidoc.element.node-red.localfilesystem.getSessions">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getSessions
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getSessions = function () {
    return when.promise(function(resolve,reject) {
        fs.readFile(sessionsFile,&#x27;utf8&#x27;,function(err,data){
            if (!err) {
                try {
                    return resolve(JSON.parse(data));
                } catch(err2) {
                    log.trace(&#x22;Corrupted sessions file - resetting&#x22;);
                }
            }
            resolve({});
        })
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        return storage.saveSessions(sessions);
    } else {
        return when.resolve();
    }
}
function loadSessions() {
    if (loadedSessions === null) {
        loadedSessions = storage.<span class="apidocCodeKeywordSpan">getSessions</span>().then(function(_sessions) {
             sessions = _sessions||{};
             return expireSessions();
        });
    }
    return loadedSessions;
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.getSettings" id="apidoc.element.node-red.localfilesystem.getSettings">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>getSettings
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getSettings = function () {
    return when.promise(function(resolve,reject) {
        fs.readFile(globalSettingsFile,&#x27;utf8&#x27;,function(err,data) {
            if (!err) {
                try {
                    return resolve(JSON.parse(data));
                } catch(err2) {
                    log.trace(&#x22;Corrupted config detected - resetting&#x22;);
                }
            }
            return resolve({});
        })
    })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            })();
        }
    }
    globalSettings = null;
},
load: function(_storage) {
    storage = _storage;
    return storage.<span class="apidocCodeKeywordSpan">getSettings</span>().then(function(_settings) {
        globalSettings = _settings;
    });
},
get: function(prop) {
    if (userSettings.hasOwnProperty(prop)) {
        return clone(userSettings[prop]);
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.init" id="apidoc.element.node-red.localfilesystem.init">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>init
        <span class="apidocSignatureSpan">(_settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (_settings) {
    settings = _settings;

    var promises = [];

    if (!settings.userDir) {
        try {
            fs.statSync(fspath.join(process.env.NODE_RED_HOME,&#x22;.config.json&#x22;));
            settings.userDir = process.env.NODE_RED_HOME;
        } catch(err) {
            settings.userDir = fspath.join(process.env.HOME || process.env.HOMEPATH || process.env.USERPROFILE || process.env.NODE_RED_HOME
,&#x22;.node-red&#x22;);
            if (!settings.readOnly) {
                promises.push(promiseDir(fspath.join(settings.userDir,&#x22;node_modules&#x22;)));
            }
        }
    }

    if (settings.flowFile) {
        flowsFile = settings.flowFile;
        // handle Unix and Windows &#x22;C:\&#x22;
        if ((flowsFile[0] == &#x22;/&#x22;) || (flowsFile[1] == &#x22;:&#x22;)) {
            // Absolute path
            flowsFullPath = flowsFile;
        } else if (flowsFile.substring(0,2) === &#x22;./&#x22;) {
            // Relative to cwd
            flowsFullPath = fspath.join(process.cwd(),flowsFile);
        } else {
            try {
                fs.statSync(fspath.join(process.cwd(),flowsFile));
                // Found in cwd
                flowsFullPath = fspath.join(process.cwd(),flowsFile);
            } catch(err) {
                // Use userDir
                flowsFullPath = fspath.join(settings.userDir,flowsFile);
            }
        }

    } else {
        flowsFile = &#x27;flows_&#x27;+require(&#x27;os&#x27;).hostname()+&#x27;.json&#x27;;
        flowsFullPath = fspath.join(settings.userDir,flowsFile);
    }
    var ffExt = fspath.extname(flowsFullPath);
    var ffName = fspath.basename(flowsFullPath);
    var ffBase = fspath.basename(flowsFullPath,ffExt);
    var ffDir = fspath.dirname(flowsFullPath);

    credentialsFile = fspath.join(settings.userDir,ffBase+&#x22;_cred&#x22;+ffExt);
    credentialsFileBackup = fspath.join(settings.userDir,&#x22;.&#x22;+ffBase+&#x22;_cred&#x22;+ffExt+&#x22;.backup&#x22;);

    oldCredentialsFile = fspath.join(settings.userDir,&#x22;credentials.json&#x22;);

    flowsFileBackup = fspath.join(ffDir,&#x22;.&#x22;+ffName+&#x22;.backup&#x22;);

    sessionsFile = fspath.join(settings.userDir,&#x22;.sessions.json&#x22;);

    libDir = fspath.join(settings.userDir,&#x22;lib&#x22;);
    libFlowsDir = fspath.join(libDir,&#x22;flows&#x22;);

    globalSettingsFile = fspath.join(settings.userDir,&#x22;.config.json&#x22;);

    if (!settings.readOnly) {
        promises.push(promiseDir(libFlowsDir));
    }

    return when.all(promises);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.saveCredentials" id="apidoc.element.node-red.localfilesystem.saveCredentials">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveCredentials
        <span class="apidocSignatureSpan">(credentials)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">saveCredentials = function (credentials) {
    if (settings.readOnly) {
        return when.resolve();
    }

    try {
        fs.renameSync(credentialsFile,credentialsFileBackup);
    } catch(err) {
    }
    var credentialData;
    if (settings.flowFilePretty) {
        credentialData = JSON.stringify(credentials,null,4);
    } else {
        credentialData = JSON.stringify(credentials);
    }
    return writeFile(credentialsFile, credentialData);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
});
        },
        saveFlows: function(config) {
var flows = config.flows;
var credentials = config.credentials;
var credentialSavePromise;
if (config.credentialsDirty) {
    credentialSavePromise = storageModule.<span class="apidocCodeKeywordSpan">saveCredentials</span>(credentials);
} else {
    credentialSavePromise = when.resolve();
}
delete config.credentialsDirty;

return credentialSavePromise.then(function() {
    return storageModule.saveFlows(flows).then(function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.saveFlows" id="apidoc.element.node-red.localfilesystem.saveFlows">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveFlows
        <span class="apidocSignatureSpan">(flows)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">saveFlows = function (flows) {
    if (settings.readOnly) {
        return when.resolve();
    }

    try {
        fs.renameSync(flowsFullPath,flowsFileBackup);
    } catch(err) {
    }

    var flowData;

    if (settings.flowFilePretty) {
        flowData = JSON.stringify(flows,null,4);
    } else {
        flowData = JSON.stringify(flows);
    }
    return writeFile(flowsFullPath, flowData);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        credentialSavePromise = storageModule.saveCredentials(credentials);
    } else {
        credentialSavePromise = when.resolve();
    }
    delete config.credentialsDirty;

    return credentialSavePromise.then(function() {
        return storageModule.<span class="apidocCodeKeywordSpan">saveFlows</span>(flows).then(function() {
            return crypto.createHash(&#x27;md5&#x27;).update(JSON.stringify(config)).digest(&#x22;hex&#x22;);
        })
    });
},
// getCredentials: function() {
//     return storageModule.getCredentials();
// },
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.saveLibraryEntry" id="apidoc.element.node-red.localfilesystem.saveLibraryEntry">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveLibraryEntry
        <span class="apidocSignatureSpan">(type, path, meta, body)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">saveLibraryEntry = function (type, path, meta, body) {
    if (settings.readOnly) {
        return when.resolve();
    }
    var fn = fspath.join(libDir, type, path);
    var headers = &#x22;&#x22;;
    for (var i in meta) {
        if (meta.hasOwnProperty(i)) {
            headers += &#x22;// &#x22;+i+&#x22;: &#x22;+meta[i]+&#x22;\n&#x22;;
        }
    }
    if (type === &#x22;flows&#x22; &#x26;&#x26; settings.flowFilePretty) {
        body = JSON.stringify(JSON.parse(body),null,4);
    }
    return promiseDir(fspath.dirname(fn)).then(function () {
        writeFile(fn,headers+body);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

        redApp.post(new RegExp(&#x22;/library/&#x22;+type+&#x22;\/(.*)&#x22;),needsPermission(&#x22;library.write&#x22;),function
(req,res) {
var path = req.params[0];
var meta = req.body;
var text = meta.text;
delete meta.text;

storage.<span class="apidocCodeKeywordSpan">saveLibraryEntry</span>(type,path,meta,text).then(function() {
    log.audit({event: &#x22;library.set&#x22;,type:type},req);
    res.status(204).end();
}).otherwise(function(err) {
    log.warn(log._(&#x22;api.library.error-save-entry&#x22;,{path:path,message:err.toString()}));
        if (err.code === &#x27;forbidden&#x27;) {
        log.audit({event: &#x22;library.set&#x22;,type:type,error:&#x22;forbidden&#x22;},req);
        res.status(403).end();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.saveSessions" id="apidoc.element.node-red.localfilesystem.saveSessions">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveSessions
        <span class="apidocSignatureSpan">(sessions)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">saveSessions = function (sessions) {
    if (settings.readOnly) {
        return when.resolve();
    }
    return writeFile(sessionsFile,JSON.stringify(sessions));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        if (!session.hasOwnProperty(&#x22;expires&#x22;) || session.expires &#x3c; now) {
            delete sessions[t];
            modified = true;
        }
    }
}
if (modified) {
    return storage.<span class="apidocCodeKeywordSpan">saveSessions</span>(sessions);
} else {
    return when.resolve();
}
}
function loadSessions() {
if (loadedSessions === null) {
    loadedSessions = storage.getSessions().then(function(_sessions) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.localfilesystem.saveSettings" id="apidoc.element.node-red.localfilesystem.saveSettings">
        function <span class="apidocSignatureSpan">node-red.localfilesystem.</span>saveSettings
        <span class="apidocSignatureSpan">(newSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">saveSettings = function (newSettings) {
    if (settings.readOnly) {
        return when.resolve();
    }
    return writeFile(globalSettingsFile,JSON.stringify(newSettings,null,1));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
    var current = globalSettings[prop];
    globalSettings[prop] = value;
    try {
        assert.deepEqual(current,value);
        return when.resolve();
    } catch(err) {
        return storage.<span class="apidocCodeKeywordSpan">saveSettings</span>(globalSettings);
    }
},
delete: function(prop) {
    if (userSettings.hasOwnProperty(prop)) {
        throw new Error(log._(&#x22;settings.property-read-only&#x22;, {prop:prop}));
    }
    if (globalSettings === null) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.log" id="apidoc.module.node-red.log">module node-red.log</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.log.log" id="apidoc.element.node-red.log.log">
        function <span class="apidocSignatureSpan">node-red.</span>log
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (msg) {
    msg.timestamp = Date.now();
    logHandlers.forEach(function(handler) {
        handler.emit(&#x22;log&#x22;,msg);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// As we want to reserve -t for now, adding a shorthand to help so it
// doesn&#x27;t get treated as --title
&#x22;t&#x22;:[&#x22;--help&#x22;],
&#x22;u&#x22;:[&#x22;--userDir&#x22;],
&#x22;v&#x22;:[&#x22;--verbose&#x22;]
};
nopt.invalidHandler = function(k,v,t) {
// TODO: console.<span class="apidocCodeKeywordSpan">log</span>(k,v,t);
}

var parsedArgs = nopt(knownOpts,shortHands,process.argv,2)

if (parsedArgs.help) {
console.log(&#x22;Node-RED v&#x22;+RED.version());
console.log(&#x22;Usage: node-red [-v] [-?] [--settings settings.js] [--userDir DIR]&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log._" id="apidoc.element.node-red.log._">
        function <span class="apidocSignatureSpan">node-red.log.</span>_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_ = function () {
    //var opts = {};
    //if (def) {
    //    opts.defaultValue = def;
    //}
    //console.log(arguments);
    return i18n.t.apply(null,arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return res.sendStatus(401);
        }
        next();
    }
}

if (settings.httpAdminRoot !== false &#x26;&#x26; settings.httpAdminAuth) {
    RED.log.warn(RED.log.<span class="apidocCodeKeywordSpan">_</span>(&#x22;server.httpadminauth-deprecated&#x22;));
    app.use(settings.httpAdminRoot, basicAuthMiddleware(settings.httpAdminAuth.user,settings.httpAdminAuth.pass));
}

if (settings.httpAdminRoot !== false) {
    app.use(settings.httpAdminRoot,RED.httpAdmin);
}
if (settings.httpNodeRoot !== false &#x26;&#x26; settings.httpNodeAuth) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.addHandler" id="apidoc.element.node-red.log.addHandler">
        function <span class="apidocSignatureSpan">node-red.log.</span>addHandler
        <span class="apidocSignatureSpan">(func)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addHandler = function (func) {
    logHandlers.push(func);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    init: function(settings) {
metricsEnabled = false;
logHandlers = [];
var loggerSettings = {};
if (settings.logging) {
    var keys = Object.keys(settings.logging);
    if (keys.length === 0) {
        log.<span class="apidocCodeKeywordSpan">addHandler</span>(new LogHandler());
    } else {
        for (var i=0, l=keys.length; i&#x3c;l; i++) {
            var config = settings.logging[keys[i]];
            loggerSettings = config || {};
            if ((keys[i] === &#x22;console&#x22;) || config.handler) {
                log.addHandler(new LogHandler(loggerSettings));
            }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.audit" id="apidoc.element.node-red.log.audit">
        function <span class="apidocSignatureSpan">node-red.log.</span>audit
        <span class="apidocSignatureSpan">(msg, req)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">audit = function (msg, req) {
    msg.level = log.AUDIT;
    if (req) {
        msg.user = req.user;
        msg.path = req.path;
        msg.ip = (req.headers &#x26;&#x26; req.headers[&#x27;x-forwarded-for&#x27;]) || (req.connection &#x26;&#x26; req.connection.remoteAddress) || undefined
;
    }
    log.log(msg);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    //  https://github.com/websockets/ws/pull/632
    // that is fixed in the 1.x release of the ws module
    // that we cannot currently pickup as it drops node 0.10 support
    perMessageDeflate: false
});

wsServer.on(&#x27;connection&#x27;,function(ws) {
    log.<span class="apidocCodeKeywordSpan">audit</span>({event: &#x22;comms.open&#x22;});
    var pendingAuth = (settings.adminAuth != null);
    if (!pendingAuth) {
        activeConnections.push(ws);
    } else {
        pendingConnections.push(ws);
    }
    ws.on(&#x27;close&#x27;,function() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.debug" id="apidoc.element.node-red.log.debug">
        function <span class="apidocSignatureSpan">node-red.log.</span>debug
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (msg) {
    log.log({level:log.DEBUG,msg:msg});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var userKey;
try {
    userKey = settings.get(&#x27;credentialSecret&#x27;);
} catch(err) {
    userKey = false;
}
if (userKey === false) {
    log.<span class="apidocCodeKeywordSpan">debug</span>(&#x22;red/runtime/nodes/credentials.load : user disabled encryption&#x22
;);
    // User has disabled encryption
    encryptionEnabled = false;
    // Check if we have a generated _credSecret to decrypt with and remove
    if (defaultKey) {
        log.debug(&#x22;red/runtime/nodes/credentials.load : default key present. Will migrate&#x22;);
        if (credentialsEncrypted) {
            try {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.error" id="apidoc.element.node-red.log.error">
        function <span class="apidocSignatureSpan">node-red.log.</span>error
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">error = function (msg) {
    log.log({level:log.ERROR,msg:msg});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 - Better scope handling
 - Add security checks
 - small change to udp httpadmin
 - Fix comparison to &#x22;&#x22; in tcpin
 - Change scope of clients object
 - Works when connection is left open
 - First release of multi connection tcpget
 - Fix node.<span class="apidocCodeKeywordSpan">error</span>() not printing when passed false (#1037)
 - fix test for CSV array input
 - different test for Pi (rather than use serial port name)
 - Fix missing 0 handling for css node with array input


#### 0.15.2: Maintenance Release
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.info" id="apidoc.element.node-red.log.info">
        function <span class="apidocSignatureSpan">node-red.log.</span>info
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">info = function (msg) {
    log.log({level:log.INFO,msg:msg});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                RED.log.error(err);
            }
        }
        process.exit(1);
    });
    server.listen(settings.uiPort,settings.uiHost,function() {
        if (settings.httpAdminRoot === false) {
            RED.log.<span class="apidocCodeKeywordSpan">info</span>(RED.log._(&#x22;server.admin-ui-disabled&#x22;));
        }
        process.title = parsedArgs.title || &#x27;node-red&#x27;;
        RED.log.info(RED.log._(&#x22;server.now-running&#x22;, {listenpath:getListenPath()}));
    });
} else {
    RED.log.info(RED.log._(&#x22;server.headless-mode&#x22;));
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.init" id="apidoc.element.node-red.log.init">
        function <span class="apidocSignatureSpan">node-red.log.</span>init
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (settings) {
    metricsEnabled = false;
    logHandlers = [];
    var loggerSettings = {};
    if (settings.logging) {
        var keys = Object.keys(settings.logging);
        if (keys.length === 0) {
            log.addHandler(new LogHandler());
        } else {
            for (var i=0, l=keys.length; i&#x3c;l; i++) {
                var config = settings.logging[keys[i]];
                loggerSettings = config || {};
                if ((keys[i] === &#x22;console&#x22;) || config.handler) {
                    log.addHandler(new LogHandler(loggerSettings));
                }
            }
        }
    } else {
        log.addHandler(new LogHandler());
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.metric" id="apidoc.element.node-red.log.metric">
        function <span class="apidocSignatureSpan">node-red.log.</span>metric
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metric = function () {
    return metricsEnabled;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        .then(function() {
return i18n.registerMessageCatalog(&#x22;runtime&#x22;,path.resolve(path.join(__dirname,&#x22;locales&#x22;)),&#x22;runtime.json
&#x22;)
        })
        .then(function() { return storage.init(runtime)})
        .then(function() { return settings.load(storage)})
        .then(function() {

if (log.<span class="apidocCodeKeywordSpan">metric</span>()) {
    runtimeMetricInterval = setInterval(function() {
        reportMetrics();
    }, settings.runtimeMetricInterval||15000);
}
log.info(&#x22;\n\n&#x22;+log._(&#x22;runtime.welcome&#x22;)+&#x22;\n===================\n&#x22;);
if (settings.version) {
    log.info(log._(&#x22;runtime.version&#x22;,{component:&#x22;Node-RED&#x22;,version:&#x22;v&#x22;+settings.version}));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.removeHandler" id="apidoc.element.node-red.log.removeHandler">
        function <span class="apidocSignatureSpan">node-red.log.</span>removeHandler
        <span class="apidocSignatureSpan">(func)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeHandler = function (func) {
    var index = logHandlers.indexOf(func);
    if (index &#x3e; -1) {
        logHandlers.splice(index,1);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.trace" id="apidoc.element.node-red.log.trace">
        function <span class="apidocSignatureSpan">node-red.log.</span>trace
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">trace = function (msg) {
    log.log({level:log.TRACE,msg:msg});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    removePendingConnection(ws);
});
ws.on(&#x27;message&#x27;, function(data,flags) {
    var msg = null;
    try {
        msg = JSON.parse(data);
    } catch(err) {
        log.<span class="apidocCodeKeywordSpan">trace</span>(&#x22;comms received malformed message : &#x22;+err.toString());
        return;
    }
    if (!pendingAuth) {
        if (msg.subscribe) {
            handleRemoteSubscription(ws,msg.subscribe);
        }
    } else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.log.warn" id="apidoc.element.node-red.log.warn">
        function <span class="apidocSignatureSpan">node-red.log.</span>warn
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">warn = function (msg) {
    log.log({level:log.WARN,msg:msg});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return res.sendStatus(401);
        }
        next();
    }
}

if (settings.httpAdminRoot !== false &#x26;&#x26; settings.httpAdminAuth) {
    RED.log.<span class="apidocCodeKeywordSpan">warn</span>(RED.log._(&#x22;server.httpadminauth-deprecated&#x22;));
    app.use(settings.httpAdminRoot, basicAuthMiddleware(settings.httpAdminAuth.user,settings.httpAdminAuth.pass));
}

if (settings.httpAdminRoot !== false) {
    app.use(settings.httpAdminRoot,RED.httpAdmin);
}
if (settings.httpNodeRoot !== false &#x26;&#x26; settings.httpNodeAuth) {
...</pre></li>
    </ul>


















</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.nodes" id="apidoc.module.node-red.nodes">module node-red.nodes</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.nodes.addCredentials" id="apidoc.element.node-red.nodes.addCredentials">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>addCredentials
        <span class="apidocSignatureSpan">(id, creds)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addCredentials = function (id, creds) {
    if (!credentialCache.hasOwnProperty(id) || JSON.stringify(creds) !== JSON.stringify(credentialCache[id])) {
        credentialCache[id] = creds;
        dirty = true;
    }
    return when.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.addFlow" id="apidoc.element.node-red.nodes.addFlow">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>addFlow
        <span class="apidocSignatureSpan">(flow)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addFlow(flow) {
    var i,node;
    if (!flow.hasOwnProperty(&#x27;nodes&#x27;)) {
        throw new Error(&#x27;missing nodes property&#x27;);
    }
    flow.id = redUtil.generateId();

    var nodes = [{
        type:&#x27;tab&#x27;,
        label:flow.label,
        id:flow.id
    }];

    for (i=0;i&#x3c;flow.nodes.length;i++) {
        node = flow.nodes[i];
        if (activeFlowConfig.allNodes[node.id]) {
            // TODO nls
            return when.reject(new Error(&#x27;duplicate id&#x27;));
        }
        if (node.type === &#x27;tab&#x27; || node.type === &#x27;subflow&#x27;) {
            return when.reject(new Error(&#x27;invalid node type: &#x27;+node.type));
        }
        node.z = flow.id;
        nodes.push(node);
    }
    if (flow.configs) {
        for (i=0;i&#x3c;flow.configs.length;i++) {
            node = flow.configs[i];
            if (activeFlowConfig.allNodes[node.id]) {
                // TODO nls
                return when.reject(new Error(&#x27;duplicate id&#x27;));
            }
            if (node.type === &#x27;tab&#x27; || node.type === &#x27;subflow&#x27;) {
                return when.reject(new Error(&#x27;invalid node type: &#x27;+node.type));
            }
            node.z = flow.id;
            nodes.push(node);
        }
    }
    var newConfig = clone(activeConfig.flows);
    newConfig = newConfig.concat(nodes);

    return setFlows(newConfig,&#x27;flows&#x27;,true).then(function() {
        log.info(log._(&#x22;nodes.flows.added-flow&#x22;,{label:(flow.label?flow.label+&#x22; &#x22;:&#x22;&#x22;)+&#x22;[&#x22;+flow.id+&#x22;]&#x22;}));
        return flow.id;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    } else {
        log.audit({event: &#x22;flow.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.status(404).end();
    }
},
post: function(req,res) {
    var flow = req.body;
    redNodes.<span class="apidocCodeKeywordSpan">addFlow</span>(flow).then(function(id) {
        log.audit({event: &#x22;flow.add&#x22;,id:id},req);
        res.json({id:id});
    }).otherwise(function(err) {
        log.audit({event: &#x22;flow.add&#x22;,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
        res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
    })
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.cleanModuleList" id="apidoc.element.node-red.nodes.cleanModuleList">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>cleanModuleList
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cleanModuleList() {
    var removed = false;
    for (var mod in moduleConfigs) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (moduleConfigs.hasOwnProperty(mod)) {
            var nodes = moduleConfigs[mod].nodes;
            var node;
            if (mod == &#x22;node-red&#x22;) {
                // For core nodes, look for nodes that are enabled, !loaded and !errored
                for (node in nodes) {
                    /* istanbul ignore else */
                    if (nodes.hasOwnProperty(node)) {
                        var n = nodes[node];
                        if (n.enabled &#x26;&#x26; !n.err &#x26;&#x26; !n.loaded) {
                            removeNode(mod+&#x22;/&#x22;+node);
                            removed = true;
                        }
                    }
                }
            } else {
                if (moduleConfigs[mod] &#x26;&#x26; !moduleNodes[mod]) {
                    // For node modules, look for missing ones
                    for (node in nodes) {
                        /* istanbul ignore else */
                        if (nodes.hasOwnProperty(node)) {
                            removeNode(mod+&#x22;/&#x22;+node);
                            removed = true;
                        }
                    }
                    delete moduleConfigs[mod];
                }
            }
        }
    }
    if (removed) {
        saveNodeList();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    // to stop the error propagating any further
                });
            }
        }
    }
    if (!settings.autoInstallModules) {
        log.info(log._(&#x22;server.removing-modules&#x22;));
        redNodes.<span class="apidocCodeKeywordSpan">cleanModuleList</span>();
    }
}
if (settings.settingsFile) {
    log.info(log._(&#x22;runtime.paths.settings&#x22;,{path:settings.settingsFile}));
}
redNodes.loadFlows().then(redNodes.startFlows);
started = true;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.clearRegistry" id="apidoc.element.node-red.nodes.clearRegistry">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>clearRegistry
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function clear() {
    nodeConfigCache = null;
    moduleConfigs = {};
    nodeList = [];
    nodeConstructors = {};
    nodeTypeToId = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.createNode" id="apidoc.element.node-red.nodes.createNode">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>createNode
        <span class="apidocSignatureSpan">(node, def)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createNode(node, def) {
    Node.call(node,def);
    var id = node.id;
    if (def._alias) {
        id = def._alias;
    }
    var creds = credentials.get(id);
    if (creds) {
        //console.log(&#x22;Attaching credentials to &#x22;,node.id);
        // allow $(foo) syntax to substitute env variables for credentials also...
        for (var p in creds) {
            if (creds.hasOwnProperty(p)) {
                flowUtil.mapEnvVarProperties(creds,p);
            }
        }
        node.credentials = creds;
    } else if (credentials.getDefinition(node.type)) {
        node.credentials = {};
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    &#x22;use strict&#x22;;
    // require any external libraries we may need....
    //var foo = require(&#x22;foo-library&#x22;);

    // The main node definition - most things happen in here
    function SampleNode(n) {
// Create a RED node
RED.nodes.<span class="apidocCodeKeywordSpan">createNode</span>(this,n);

// Store local copies of the node configuration (as defined in the .html)
this.topic = n.topic;

// copy &#x22;this&#x22; object in case we need it in context of callbacks of other functions.
var node = this;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.deleteCredentials" id="apidoc.element.node-red.nodes.deleteCredentials">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>deleteCredentials
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">deleteCredentials = function (id) {
    delete credentialCache[id];
    dirty = true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.disableNode" id="apidoc.element.node-red.nodes.disableNode">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>disableNode
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function disableNode(id) {
    flows.checkTypeInUse(id);
    return registry.disableNode(id);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var promise;
    if (!node.err &#x26;&#x26; node.enabled === enabled) {
promise = when.resolve(node);
    } else {
if (enabled) {
    promise = redNodes.enableNode(node.id);
} else {
    promise = redNodes.<span class="apidocCodeKeywordSpan">disableNode</span>(node.id);
}

return promise.then(function(info) {
    if (info.enabled === enabled &#x26;&#x26; !info.err) {
        comms.publish(&#x22;node/&#x22;+(enabled?&#x22;enabled&#x22;:&#x22;disabled&#x22;),info,false);
        log.info(&#x22; &#x22;+log._(&#x22;api.nodes.&#x22;+(enabled?&#x22;enabled&#x22;:&#x22;disabled&#x22;)));
        for (var i=0;i&#x3c;info.types.length;i++) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.eachNode" id="apidoc.element.node-red.nodes.eachNode">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>eachNode
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function eachNode(cb) {
    for (var id in activeFlowConfig.allNodes) {
        if (activeFlowConfig.allNodes.hasOwnProperty(id)) {
            cb(activeFlowConfig.allNodes[id]);
        }
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

/**
 * Sets the text direction preference
 * @param dir - the text direction preference
 */
function setTextDirection(dir) {
    textDir = dir;
    RED.nodes.<span class="apidocCodeKeywordSpan">eachNode</span>(function(n) { n.dirty = true;});
    RED.view.redraw();
    RED.palette.refresh();
    enforceTextDirectionOnPage();
}

return {
    setTextDirection: setTextDirection,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.enableNode" id="apidoc.element.node-red.nodes.enableNode">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>enableNode
        <span class="apidocSignatureSpan">(typeOrId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function enableNodeSet(typeOrId) {
    return registry.enableNodeSet(typeOrId).then(function() {
        var nodeSet = registry.getNodeInfo(typeOrId);
        if (!nodeSet.loaded) {
            return loader.loadNodeSet(registry.getFullNodeInfo(typeOrId)).then(function() {
                return registry.getNodeInfo(typeOrId);
            });
        }
        return when.resolve(nodeSet);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function putNode(node, enabled) {
    var info;
    var promise;
    if (!node.err &#x26;&#x26; node.enabled === enabled) {
promise = when.resolve(node);
    } else {
if (enabled) {
    promise = redNodes.<span class="apidocCodeKeywordSpan">enableNode</span>(node.id);
} else {
    promise = redNodes.disableNode(node.id);
}

return promise.then(function(info) {
    if (info.enabled === enabled &#x26;&#x26; !info.err) {
        comms.publish(&#x22;node/&#x22;+(enabled?&#x22;enabled&#x22;:&#x22;disabled&#x22;),info,false);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getCredentialDefinition" id="apidoc.element.node-red.nodes.getCredentialDefinition">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getCredentialDefinition
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCredentialDefinition = function (type) {
    return credentialsDef[type];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var nodeID = req.params.id;
log.audit({event: &#x22;credentials.get&#x22;,type:nodeType,id:nodeID},req);
var credentials = api.getCredentials(nodeID);
if (!credentials) {
    res.json({});
    return;
}
var definition = api.<span class="apidocCodeKeywordSpan">getCredentialDefinition</span>(nodeType);

var sendCredentials = {};
for (var cred in definition) {
    if (definition.hasOwnProperty(cred)) {
        if (definition[cred].type == &#x22;password&#x22;) {
            var key = &#x27;has_&#x27; + cred;
            sendCredentials[key] = credentials[cred] != null &#x26;&#x26; credentials[cred] !== &#x27;&#x27;;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getCredentials" id="apidoc.element.node-red.nodes.getCredentials">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getCredentials
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCredentials = function (id) {
    return credentialCache[id];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    get: function (req, res) {
// TODO: It should verify the given node id is of the type specified -
//       but that would add a dependency from this module to the
//       registry module that knows about node types.
var nodeType = req.params.type;
var nodeID = req.params.id;
log.audit({event: &#x22;credentials.get&#x22;,type:nodeType,id:nodeID},req);
var credentials = api.<span class="apidocCodeKeywordSpan">getCredentials</span>(nodeID);
if (!credentials) {
    res.json({});
    return;
}
var definition = api.getCredentialDefinition(nodeType);

var sendCredentials = {};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getFlow" id="apidoc.element.node-red.nodes.getFlow">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getFlow
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getFlow(id) {
    var flow;
    if (id === &#x27;global&#x27;) {
        flow = activeFlowConfig;
    } else {
        flow = activeFlowConfig.flows[id];
    }
    if (!flow) {
        return null;
    }
    var result = {
        id: id
    };
    if (flow.label) {
        result.label = flow.label;
    }
    if (id !== &#x27;global&#x27;) {
        result.nodes = [];
    }
    if (flow.nodes) {
        var nodeIds = Object.keys(flow.nodes);
        if (nodeIds.length &#x3e; 0) {
            result.nodes = nodeIds.map(function(nodeId) {
                var node = clone(flow.nodes[nodeId]);
                if (node.type === &#x27;link out&#x27;) {
                    delete node.wires;
                }
                return node;
            })
        }
    }
    if (flow.configs) {
        var configIds = Object.keys(flow.configs);
        result.configs = configIds.map(function(configId) {
            return clone(flow.configs[configId]);
        })
        if (result.configs.length === 0) {
            delete result.configs;
        }
    }
    if (flow.subflows) {
        var subflowIds = Object.keys(flow.subflows);
        result.subflows = subflowIds.map(function(subflowId) {
            var subflow = clone(flow.subflows[subflowId]);
            var nodeIds = Object.keys(subflow.nodes);
            subflow.nodes = nodeIds.map(function(id) {
                return subflow.nodes[id];
            });
            if (subflow.configs) {
                var configIds = Object.keys(subflow.configs);
                subflow.configs = configIds.map(function(id) {
                    return subflow.configs[id];
                })
            }
            delete subflow.instances;
            return subflow;
        });
        if (result.subflows.length === 0) {
            delete result.subflows;
        }
    }
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
init: function(runtime) {
    settings = runtime.settings;
    redNodes = runtime.nodes;
    log = runtime.log;
},
get: function(req,res) {
    var id = req.params.id;
    var flow = redNodes.<span class="apidocCodeKeywordSpan">getFlow</span>(id);
    if (flow) {
        log.audit({event: &#x22;flow.get&#x22;,id:id},req);
        res.json(flow);
    } else {
        log.audit({event: &#x22;flow.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.status(404).end();
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getFlows" id="apidoc.element.node-red.nodes.getFlows">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getFlows
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getFlows() {
    return activeConfig;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    redNodes = runtime.nodes;
    log = runtime.log;
},
get: function(req,res) {
    var version = req.get(&#x22;Node-RED-API-Version&#x22;)||&#x22;v1&#x22;;
    if (version === &#x22;v1&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v1&#x22;},req);
        res.json(redNodes.<span class="apidocCodeKeywordSpan">getFlows</span>().flows);
    } else if (version === &#x22;v2&#x22;) {
        log.audit({event: &#x22;flows.get&#x22;,version:&#x22;v2&#x22;},req);
        res.json(redNodes.getFlows());
    } else {
        log.audit({event: &#x22;flows.get&#x22;,version:version,error:&#x22;invalid_api_version&#x22;},req);
        res.status(400).json({code:&#x22;invalid_api_version&#x22;, message:&#x22;Invalid API Version requested&#x22;});
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getModuleInfo" id="apidoc.element.node-red.nodes.getModuleInfo">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getModuleInfo
        <span class="apidocSignatureSpan">(module)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getModuleInfo(module) {
    if (moduleNodes[module]) {
        var nodes = moduleNodes[module];
        var m = {
            name: module,
            version: moduleConfigs[module].version,
            local: moduleConfigs[module].local,
            nodes: []
        };
        for (var i = 0; i &#x3c; nodes.length; ++i) {
            var nodeInfo = filterNodeInfo(moduleConfigs[module].nodes[nodes[i]]);
            nodeInfo.version = m.version;
            m.nodes.push(nodeInfo);
        }
        return m;
    } else {
        return null;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    log.audit({event: &#x22;nodes.install&#x22;,error:&#x22;settings_unavailable&#x22;},req);
    res.status(400).json({error:&#x22;settings_unavailable&#x22;, message:&#x22;Settings unavailable&#x22;});
    return;
}
var node = req.body;
var promise;
if (node.module) {
    var module = redNodes.<span class="apidocCodeKeywordSpan">getModuleInfo</span>(node.module);
    if (module) {
        log.audit({event: &#x22;nodes.install&#x22;,module:node.module,error:&#x22;module_already_loaded&#x22;},req);
        res.status(400).json({error:&#x22;module_already_loaded&#x22;, message:&#x22;Module already loaded&#x22;});
        return;
    }
    promise = redNodes.installModule(node.module);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getNode" id="apidoc.element.node-red.nodes.getNode">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getNode
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getNode(id) {
    var node;
    if (activeNodesToFlow[id] &#x26;&#x26; activeFlows[activeNodesToFlow[id]]) {
        return activeFlows[activeNodesToFlow[id]].getNode(id);
    }
    for (var flowId in activeFlows) {
        if (activeFlows.hasOwnProperty(flowId)) {
            node = activeFlows[flowId].getNode(id);
            if (node) {
                return node;
            }
        }
    }
    return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        this.cronjob.stop();
        if (RED.settings.verbose) { this.log(RED._(&#x22;inject.stopped&#x22;)); }
        delete this.cronjob;
    }
}

RED.httpAdmin.post(&#x22;/inject/:id&#x22;, RED.auth.needsPermission(&#x22;inject.write&#x22;), function(req,res) {
    var node = RED.nodes.<span class="apidocCodeKeywordSpan">getNode</span>(req.params.id);
    if (node != null) {
        try {
            node.receive();
            res.sendStatus(200);
        } catch(err) {
            res.sendStatus(500);
            node.error(RED._(&#x22;inject.failed&#x22;,{error:err.toString()}));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getNodeConfig" id="apidoc.element.node-red.nodes.getNodeConfig">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeConfig
        <span class="apidocSignatureSpan">(id, lang)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getNodeConfig(id, lang) {
    var config = moduleConfigs[getModule(id)];
    if (!config) {
        return null;
    }
    config = config.nodes[getNode(id)];
    if (config) {
        var result = config.config;
        result += loader.getNodeHelp(config,lang||&#x22;en-US&#x22;)

        //if (config.script) {
        //    result += &#x27;&#x3c;script type=&#x22;text/javascript&#x22;&#x3e;&#x27;+config.script+&#x27;&#x3c;/script&#x3e;&#x27;;
        //}
        return result;
    } else {
        return null;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        res.send(result);
    } else {
        log.audit({event: &#x22;nodes.info.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.status(404).end();
    }
} else {
    var lang = locales.determineLangFromHeaders(req.acceptsLanguages());
    result = redNodes.<span class="apidocCodeKeywordSpan">getNodeConfig</span>(id,lang);
    if (result) {
        log.audit({event: &#x22;nodes.config.get&#x22;,id:id},req);
        res.send(result);
    } else {
        log.audit({event: &#x22;nodes.config.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
        res.status(404).end();
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getNodeConfigs" id="apidoc.element.node-red.nodes.getNodeConfigs">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeConfigs
        <span class="apidocSignatureSpan">(lang)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getAllNodeConfigs(lang) {
    if (!nodeConfigCache) {
        var result = &#x22;&#x22;;
        var script = &#x22;&#x22;;
        for (var i=0;i&#x3c;nodeList.length;i++) {
            var id = nodeList[i];
            var config = moduleConfigs[getModule(id)].nodes[getNode(id)];
            if (config.enabled &#x26;&#x26; !config.err) {
                result += config.config;
                result += loader.getNodeHelp(config,lang||&#x22;en-US&#x22;)||&#x22;&#x22;;
                //script += config.script;
            }
        }
        //if (script.length &#x3e; 0) {
        //    result += &#x27;&#x3c;script type=&#x22;text/javascript&#x22;&#x3e;&#x27;;
        //    result += UglifyJS.minify(script, {fromString: true}).code;
        //    result += &#x27;&#x3c;/script&#x3e;&#x27;;
        //}
        nodeConfigCache = result;
    }
    return nodeConfigCache;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
getAll: function(req,res) {
    if (req.get(&#x22;accept&#x22;) == &#x22;application/json&#x22;) {
        log.audit({event: &#x22;nodes.list.get&#x22;},req);
        res.json(redNodes.getNodeList());
    } else {
        var lang = locales.determineLangFromHeaders(req.acceptsLanguages());
        log.audit({event: &#x22;nodes.configs.get&#x22;},req);
        res.send(redNodes.<span class="apidocCodeKeywordSpan">getNodeConfigs</span>(lang));
    }
},

post: function(req,res) {
    if (!settings.available()) {
        log.audit({event: &#x22;nodes.install&#x22;,error:&#x22;settings_unavailable&#x22;},req);
        res.status(400).json({error:&#x22;settings_unavailable&#x22;, message:&#x22;Settings unavailable&#x22;});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getNodeInfo" id="apidoc.element.node-red.nodes.getNodeInfo">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeInfo
        <span class="apidocSignatureSpan">(typeOrId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getNodeInfo(typeOrId) {
    var id = typeOrId;
    if (nodeTypeToId.hasOwnProperty(typeOrId)) {
        id = nodeTypeToId[typeOrId];
    }
<span class="apidocCodeCommentSpan">    /* istanbul ignore else */
</span>    if (id) {
        var module = moduleConfigs[getModule(id)];
        if (module) {
            var config = module.nodes[getNode(id)];
            if (config) {
                var info = filterNodeInfo(config);
                if (config.hasOwnProperty(&#x22;loaded&#x22;)) {
                    info.loaded = config.loaded;
                }
                info.version = module.version;
                return info;
            }
        }
    }
    return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    }
},

getSet: function(req,res) {
    var id = req.params[0] + &#x22;/&#x22; + req.params[2];
    var result = null;
    if (req.get(&#x22;accept&#x22;) === &#x22;application/json&#x22;) {
        result = redNodes.<span class="apidocCodeKeywordSpan">getNodeInfo</span>(id);
        if (result) {
            log.audit({event: &#x22;nodes.info.get&#x22;,id:id},req);
            delete result.loaded;
            res.send(result);
        } else {
            log.audit({event: &#x22;nodes.info.get&#x22;,id:id,error:&#x22;not_found&#x22;},req);
            res.status(404).end();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getNodeList" id="apidoc.element.node-red.nodes.getNodeList">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getNodeList
        <span class="apidocSignatureSpan">(filter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getNodeList(filter) {
    var list = [];
    for (var module in moduleConfigs) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (moduleConfigs.hasOwnProperty(module)) {
            var nodes = moduleConfigs[module].nodes;
            for (var node in nodes) {
                /* istanbul ignore else */
                if (nodes.hasOwnProperty(node)) {
                    var nodeInfo = filterNodeInfo(nodes[node]);
                    nodeInfo.version = moduleConfigs[module].version;
                    if (!filter || filter(nodes[node])) {
                        list.push(nodeInfo);
                    }
                }
            }
        }
    }
    return list;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    log = runtime.log;
    i18n = runtime.i18n;
    settings = runtime.settings;
},
getAll: function(req,res) {
    if (req.get(&#x22;accept&#x22;) == &#x22;application/json&#x22;) {
        log.audit({event: &#x22;nodes.list.get&#x22;},req);
        res.json(redNodes.<span class="apidocCodeKeywordSpan">getNodeList</span>());
    } else {
        var lang = locales.determineLangFromHeaders(req.acceptsLanguages());
        log.audit({event: &#x22;nodes.configs.get&#x22;},req);
        res.send(redNodes.getNodeConfigs(lang));
    }
},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.getType" id="apidoc.element.node-red.nodes.getType">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>getType
        <span class="apidocSignatureSpan">(type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getNodeConstructor(type) {
    var id = nodeTypeToId[type];

    var config;
    if (typeof id === &#x22;undefined&#x22;) {
        config = undefined;
    } else {
        config = moduleConfigs[getModule(id)].nodes[getNode(id)];
    }

    if (!config || (config.enabled &#x26;&#x26; !config.err)) {
        return nodeConstructors[type];
    }
    return null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    $(&#x22;&#x3c;span&#x3e;&#x22;).html(i+1).appendTo(port);
    var links = $(&#x22;&#x3c;ul&#x3e;&#x22;).appendTo(port);
    p.forEach(function(d) {
        c++;
        var entry = $(&#x22;&#x3c;li&#x3e;&#x22;).appendTo(links);
        var node = allNodes[d];
        if (node) {
            var def = RED.nodes.<span class="apidocCodeKeywordSpan">getType</span>(node.type)||{};
            createNode(node,def).appendTo(entry);
        } else {
            entry.html(d);
        }
    })
} else {
    port.html(&#x27;none&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.init" id="apidoc.element.node-red.nodes.init">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(runtime) {
    settings = runtime.settings;
    credentials.init(runtime);
    flows.init(runtime);
    registry.init(runtime);
    context.init(runtime.settings);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.installModule" id="apidoc.element.node-red.nodes.installModule">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>installModule
        <span class="apidocSignatureSpan">(module)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function installModule(module) {
    //TODO: ensure module is &#x27;safe&#x27;
    return when.promise(function(resolve,reject) {
        var installName = module;

        try {
            if (moduleRe.test(module)) {
                // Simple module name - assume it can be npm installed
            } else if (slashRe.test(module)) {
                // A path - check if there&#x27;s a valid package.json
                installName = module;
                module = checkModulePath(module);
            }
            checkExistingModule(module);
        } catch(err) {
            return reject(err);
        }
        log.info(log._(&#x22;server.install.installing&#x22;,{name: module}));

        var installDir = settings.userDir || process.env.NODE_RED_HOME || &#x22;.&#x22;;
        var child = child_process.execFile(npmCommand,[&#x27;install&#x27;,&#x27;--production&#x27;,installName],
            {
                cwd: installDir
            },
            function(err, stdin, stdout) {
                if (err) {
                    var lookFor404 = new RegExp(&#x22; 404 .*&#x22;+installName+&#x22;$&#x22;,&#x22;m&#x22;);
                    if (lookFor404.test(stdout)) {
                        log.warn(log._(&#x22;server.install.install-failed-not-found&#x22;,{name:module}));
                        var e = new Error(&#x22;Module not found&#x22;);
                        e.code = 404;
                        reject(e);
                    } else {
                        log.warn(log._(&#x22;server.install.install-failed-long&#x22;,{name:module}));
                        log.warn(&#x22;------------------------------------------&#x22;);
                        log.warn(err.toString());
                        log.warn(&#x22;------------------------------------------&#x22;);
                        reject(new Error(log._(&#x22;server.install.install-failed&#x22;)));
                    }
                } else {
                    log.info(log._(&#x22;server.install.installed&#x22;,{name:module}));
                    resolve(require(&#x22;./index&#x22;).addModule(module).then(reportAddedModules));
                }
            }
        );
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (node.module) {
    var module = redNodes.getModuleInfo(node.module);
    if (module) {
        log.audit({event: &#x22;nodes.install&#x22;,module:node.module,error:&#x22;module_already_loaded&#x22;},req);
        res.status(400).json({error:&#x22;module_already_loaded&#x22;, message:&#x22;Module already loaded&#x22;});
        return;
    }
    promise = redNodes.<span class="apidocCodeKeywordSpan">installModule</span>(node.module);
} else {
    log.audit({event: &#x22;nodes.install&#x22;,module:node.module,error:&#x22;invalid_request&#x22;},req);
    res.status(400).json({error:&#x22;invalid_request&#x22;, message:&#x22;Invalid request&#x22;});
    return;
}
promise.then(function(info) {
    comms.publish(&#x22;node/added&#x22;,info.nodes,false);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.load" id="apidoc.element.node-red.nodes.load">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>load
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function load() {
    registry.load();
    return installer.checkPrereq().then(loader.load);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
$(&#x22;#btn-usermenu-submenu li&#x22;).remove();
if (RED.settings.user.anonymous) {
    RED.menu.addItem(&#x22;btn-usermenu&#x22;,{
        id:&#x22;usermenu-item-login&#x22;,
        label:RED._(&#x22;menu.label.login&#x22;),
        onselect: function() {
            RED.user.login({cancelable:true},function() {
                RED.settings.<span class="apidocCodeKeywordSpan">load</span>(function() {
                    RED.notify(RED._(&#x22;user.loggedInAs&#x22;,{name:RED.settings.user.username}),&#x22;success&#x22;);
                    updateUserMenu();
                });
            });
        }
    });
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.loadFlows" id="apidoc.element.node-red.nodes.loadFlows">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>loadFlows
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function load() {
    return setFlows(null,&#x22;load&#x22;,false);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
},
post: function(req,res) {
    var version = req.get(&#x22;Node-RED-API-Version&#x22;)||&#x22;v1&#x22;;
    var flows = req.body;
    var deploymentType = req.get(&#x22;Node-RED-Deployment-Type&#x22;)||&#x22;full&#x22;;
    log.audit({event: &#x22;flows.set&#x22;,type:deploymentType,version:version},req);
    if (deploymentType === &#x27;reload&#x27;) {
        redNodes.<span class="apidocCodeKeywordSpan">loadFlows</span>().then(function() {
            res.status(204).end();
        }).otherwise(function(err) {
            log.warn(log._(&#x22;api.flows.error-reload&#x22;,{message:err.message}));
            log.warn(err.stack);
            res.status(500).json({error:&#x22;unexpected_error&#x22;, message:err.message});
        });
    } else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.paletteEditorEnabled" id="apidoc.element.node-red.nodes.paletteEditorEnabled">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>paletteEditorEnabled
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">paletteEditorEnabled = function () {
    return paletteEditorEnabled
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        safeSettings.paletteCategories = settings.paletteCategories;
    }

    if (settings.flowFilePretty) {
        safeSettings.flowFilePretty = settings.flowFilePretty;
    }

    if (!runtime.nodes.<span class="apidocCodeKeywordSpan">paletteEditorEnabled</span>()) {
        safeSettings.editorTheme = safeSettings.editorTheme || {};
        safeSettings.editorTheme.palette = safeSettings.editorTheme.palette || {};
        safeSettings.editorTheme.palette.editable = false;
    }

    res.json(safeSettings);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.registerType" id="apidoc.element.node-red.nodes.registerType">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>registerType
        <span class="apidocSignatureSpan">(nodeSet, type, constructor, opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function registerType(nodeSet, type, constructor, opts) {
    if (typeof type !== &#x22;string&#x22;) {
        // This is someone calling the api directly, rather than via the
        // RED object provided to a node. Log a warning
        log.warn(&#x22;[&#x22;+nodeSet+&#x22;] Deprecated call to RED.runtime.nodes.registerType - node-set name must be provided as first argument
&#x22;);
        opts = constructor;
        constructor = type;
        type = nodeSet;
        nodeSet = &#x22;&#x22;;
    }
    if (opts &#x26;&#x26; opts.credentials) {
        credentials.register(type,opts.credentials);
    }
    registry.registerType(nodeSet,type,constructor);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
   &#x3c;p&#x3e;Outputs an object called &#x3c;code&#x3e;msg&#x3c;/code&#x3e; containing &#x3c;code&#x3e;msg.topic&#x3c;/code&#x3e
; and
   &#x3c;code&#x3e;msg.payload&#x3c;/code&#x3e;. msg.payload is a String.&#x3c;/p&#x3e;
&#x3c;/script&#x3e;

&#x3c;!-- Finally, the node type is registered along with all of its properties   --&#x3e;
&#x3c;!-- The example below shows a small subset of the properties that can be set--&#x3e;
&#x3c;script type=&#x22;text/javascript&#x22;&#x3e;
RED.nodes.<span class="apidocCodeKeywordSpan">registerType</span>(&#x27;sample&#x27;,{
    category: &#x27;input&#x27;,      // the palette category
    defaults: {             // defines the editable properties of the node
        name: {value:&#x22;&#x22;},   //  along with default values.
        topic: {value:&#x22;&#x22;, required:true}
    },
    inputs:1,               // set the number of inputs - only 0 or 1
    outputs:1,              // set the number of outputs - 0 to n
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.removeFlow" id="apidoc.element.node-red.nodes.removeFlow">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>removeFlow
        <span class="apidocSignatureSpan">(id)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function removeFlow(id) {
    if (id === &#x27;global&#x27;) {
        // TODO: nls + error code
        throw new Error(&#x27;not allowed to remove global&#x27;);
    }
    var flow = activeFlowConfig.flows[id];
    if (!flow) {
        var e = new Error();
        e.code = 404;
        throw e;
    }

    var newConfig = clone(activeConfig.flows);
    newConfig = newConfig.filter(function(node) {
        return node.z !== id &#x26;&#x26; node.id !== id;
    });

    return setFlows(newConfig,&#x27;flows&#x27;,true).then(function() {
        log.info(log._(&#x22;nodes.flows.removed-flow&#x22;,{label:(flow.label?flow.label+&#x22; &#x22;:&#x22;&#x22;)+&#x22;[&#x22;+flow.id+&#x22;]&#x22;}));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
        }
    }
},
delete: function(req,res) {
    var id = req.params.id;
    try {
        redNodes.<span class="apidocCodeKeywordSpan">removeFlow</span>(id).then(function() {
            log.audit({event: &#x22;flow.remove&#x22;,id:id},req);
            res.status(204).end();
        })
    } catch(err) {
        if (err.code === 404) {
            log.audit({event: &#x22;flow.remove&#x22;,id:id,error:&#x22;not_found&#x22;},req);
            res.status(404).end();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.setFlows" id="apidoc.element.node-red.nodes.setFlows">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>setFlows
        <span class="apidocSignatureSpan">(_config, type, muteLog)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setFlows(_config, type, muteLog) {
    type = type||&#x22;full&#x22;;

    var configSavePromise = null;
    var config = null;
    var diff;
    var newFlowConfig;
    var isLoad = false;
    if (type === &#x22;load&#x22;) {
        isLoad = true;
        configSavePromise = loadFlows().then(function(_config) {
            config = clone(_config.flows);
            newFlowConfig = flowUtil.parseConfig(clone(config));
            type = &#x22;full&#x22;;
            return _config.rev;
        });
    } else {
        config = clone(_config);
        newFlowConfig = flowUtil.parseConfig(clone(config));
        if (type !== &#x27;full&#x27;) {
            diff = flowUtil.diffConfigs(activeFlowConfig,newFlowConfig);
        }
        credentials.clean(config);
        var credsDirty = credentials.dirty();
        configSavePromise = credentials.export().then(function(creds) {
            var saveConfig = {
                flows: config,
                credentialsDirty:credsDirty,
                credentials: creds
            }
            return storage.saveFlows(saveConfig);
        });
    }

    return configSavePromise
        .then(function(flowRevision) {
            if (!isLoad) {
                log.debug(&#x22;saved flow revision: &#x22;+flowRevision);
            }
            activeConfig = {
                flows:config,
                rev:flowRevision
            };
            activeFlowConfig = newFlowConfig;
            if (started) {
                return stop(type,diff,muteLog).then(function() {
                    context.clean(activeFlowConfig);
                    start(type,diff,muteLog);
                    return flowRevision;
                }).otherwise(function(err) {
                })
            }
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            return res.status(409).json({code:&#x22;version_mismatch&#x22;});
        }
    }
} else if (version !== &#x27;v1&#x27;) {
    log.audit({event: &#x22;flows.set&#x22;,version:version,error:&#x22;invalid_api_version&#x22;},req);
    res.status(400).json({code:&#x22;invalid_api_version&#x22;, message:&#x22;Invalid API Version requested&#x22;});
}
redNodes.<span class="apidocCodeKeywordSpan">setFlows</span>(flowConfig,deploymentType).then(function(flowId) {
    if (version === &#x22;v1&#x22;) {
        res.status(204).end();
    } else if (version === &#x22;v2&#x22;) {
        res.json({rev:flowId});
    } else {
        // TODO: invalid version
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.startFlows" id="apidoc.element.node-red.nodes.startFlows">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>startFlows
        <span class="apidocSignatureSpan">(type, diff, muteLog)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function start(type, diff, muteLog) {
    //dumpActiveNodes();
    type = type||&#x22;full&#x22;;
    started = true;
    var i;
    if (activeFlowConfig.missingTypes.length &#x3e; 0) {
        log.info(log._(&#x22;nodes.flows.missing-types&#x22;));
        var knownUnknowns = 0;
        for (i=0;i&#x3c;activeFlowConfig.missingTypes.length;i++) {
            var nodeType = activeFlowConfig.missingTypes[i];
            var info = deprecated.get(nodeType);
            if (info) {
                log.info(log._(&#x22;nodes.flows.missing-type-provided&#x22;,{type:activeFlowConfig.missingTypes[i],module:info.module}));
                knownUnknowns += 1;
            } else {
                log.info(&#x22; - &#x22;+activeFlowConfig.missingTypes[i]);
            }
        }
        if (knownUnknowns &#x3e; 0) {
            log.info(log._(&#x22;nodes.flows.missing-type-install-1&#x22;));
            log.info(&#x22;  npm install &#x3c;module name&#x3e;&#x22;);
            log.info(log._(&#x22;nodes.flows.missing-type-install-2&#x22;));
            log.info(&#x22;  &#x22;+settings.userDir);
        }
        events.emit(&#x22;runtime-event&#x22;,{id:&#x22;runtime-state&#x22;,type:&#x22;warning&#x22;,text:&#x22;notification.warnings.missing-types&#x22;});
        return when.resolve();
    }
    if (!muteLog) {
        if (diff) {
            log.info(log._(&#x22;nodes.flows.starting-modified-&#x22;+type));
        } else {
            log.info(log._(&#x22;nodes.flows.starting-flows&#x22;));
        }
    }
    var id;
    if (!diff) {
        if (!activeFlows[&#x27;global&#x27;]) {
            activeFlows[&#x27;global&#x27;] = Flow.create(activeFlowConfig);
        }
        for (id in activeFlowConfig.flows) {
            if (activeFlowConfig.flows.hasOwnProperty(id)) {
                if (!activeFlows[id]) {
                    activeFlows[id] = Flow.create(activeFlowConfig,activeFlowConfig.flows[id]);
                }
            }
        }
    } else {
        activeFlows[&#x27;global&#x27;].update(activeFlowConfig,activeFlowConfig);
        for (id in activeFlowConfig.flows) {
            if (activeFlowConfig.flows.hasOwnProperty(id)) {
                if (activeFlows[id]) {
                    activeFlows[id].update(activeFlowConfig,activeFlowConfig.flows[id]);
                } else {
                    activeFlows[id] = Flow.create(activeFlowConfig,activeFlowConfig.flows[id]);
                }
            }
        }
    }

    for (id in activeFlows) {
        if (activeFlows.hasOwnProperty(id)) {
            activeFlows[id].start(diff);
            var activeNodes = activeFlows[id].getActiveNodes();
            Object.keys(activeNodes).forEach(function(nid) {
                activeNodesToFlow[nid] = id;
                if (activeNodes[nid]._alias) {
                    subflowInstanceNodeMap[activeNodes[nid]._alias] = subflowInstanceNodeMap[activeNodes[nid]._alias] || [];
                    subflowInstanceNodeMap[activeNodes[nid]._alias].push(nid);
                }
            });

        }
    }
    events.emit(&#x22;nodes-started&#x22;);
    events.emit(&#x22;runtime-event&#x22;,{id:&#x22;runtime-state&#x22;});

    if (!muteLog) {
        if (diff) {
            log.info(log._(&#x22;nodes.flows.started-modified-&#x22;+type));
        } else {
            log.info(log._(&#x22;nodes.flows.started-flows&#x22;));
        }
    }
    return when.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.stopFlows" id="apidoc.element.node-red.nodes.stopFlows">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>stopFlows
        <span class="apidocSignatureSpan">(type, diff, muteLog)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function stop(type, diff, muteLog) {
    type = type||&#x22;full&#x22;;
    if (!muteLog) {
        if (diff) {
            log.info(log._(&#x22;nodes.flows.stopping-modified-&#x22;+type));
        } else {
            log.info(log._(&#x22;nodes.flows.stopping-flows&#x22;));
        }
    }
    started = false;
    var promises = [];
    var stopList;
    if (type === &#x27;nodes&#x27;) {
        stopList = diff.changed.concat(diff.removed);
    } else if (type === &#x27;flows&#x27;) {
        stopList = diff.changed.concat(diff.removed).concat(diff.linked);
    }
    for (var id in activeFlows) {
        if (activeFlows.hasOwnProperty(id)) {
            promises = promises.concat(activeFlows[id].stop(stopList));
            if (!diff || diff.removed.indexOf(id)!==-1) {
                delete activeFlows[id];
            }
        }
    }

    return when.promise(function(resolve,reject) {
        when.settle(promises).then(function() {
            for (id in activeNodesToFlow) {
                if (activeNodesToFlow.hasOwnProperty(id)) {
                    if (!activeFlows[activeNodesToFlow[id]]) {
                        delete activeNodesToFlow[id];
                    }
                }
            }
            if (stopList) {
                stopList.forEach(function(id) {
                    delete activeNodesToFlow[id];
                });
            }
            // Ideally we&#x27;d prune just what got stopped - but mapping stopList
            // id to the list of subflow instance nodes is something only Flow
            // can do... so cheat by wiping the map knowing it&#x27;ll be rebuilt
            // in start()
            subflowInstanceNodeMap = {};
            if (!muteLog) {
                if (diff) {
                    log.info(log._(&#x22;nodes.flows.stopped-modified-&#x22;+type));
                } else {
                    log.info(log._(&#x22;nodes.flows.stopped-flows&#x22;));
                }
            }
            resolve();
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

function stop() {
if (runtimeMetricInterval) {
    clearInterval(runtimeMetricInterval);
    runtimeMetricInterval = null;
}
started = false;
return redNodes.<span class="apidocCodeKeywordSpan">stopFlows</span>();
}

var runtime = module.exports = {
init: init,
start: start,
stop: stop,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.uninstallModule" id="apidoc.element.node-red.nodes.uninstallModule">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>uninstallModule
        <span class="apidocSignatureSpan">(module)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function uninstallModule(module) {
    var info = registry.getModuleInfo(module);
    if (!info) {
        throw new Error(log._(&#x22;nodes.index.unrecognised-module&#x22;, {module:module}));
    } else {
        for (var i=0;i&#x3c;info.nodes.length;i++) {
            flows.checkTypeInUse(module+&#x22;/&#x22;+info.nodes[i].name);
        }
        return registry.uninstallModule(module);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var promise = null;
var module = redNodes.getModuleInfo(mod);
if (!module) {
    log.audit({event: &#x22;nodes.remove&#x22;,module:mod,error:&#x22;not_found&#x22;},req);
    res.status(404).end();
    return;
} else {
    promise = redNodes.<span class="apidocCodeKeywordSpan">uninstallModule</span>(mod);
}

promise.then(function(list) {
    comms.publish(&#x22;node/removed&#x22;,list,false);
    log.audit({event: &#x22;nodes.remove&#x22;,module:mod},req);
    res.status(204).end();
}).otherwise(function(err) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.nodes.updateFlow" id="apidoc.element.node-red.nodes.updateFlow">
        function <span class="apidocSignatureSpan">node-red.nodes.</span>updateFlow
        <span class="apidocSignatureSpan">(id, newFlow)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateFlow(id, newFlow) {
    var label = id;
    if (id !== &#x27;global&#x27;) {
        if (!activeFlowConfig.flows[id]) {
            var e = new Error();
            e.code = 404;
            throw e;
        }
        label = activeFlowConfig.flows[id].label;
    }
    var newConfig = clone(activeConfig.flows);
    var nodes;

    if (id === &#x27;global&#x27;) {
        // Remove all nodes whose z is not a known flow
        // When subflows can be owned by a flow, this logic will have to take
        // that into account
        newConfig = newConfig.filter(function(node) {
            return node.type === &#x27;tab&#x27; || (node.hasOwnProperty(&#x27;z&#x27;) &#x26;&#x26; activeFlowConfig.flows.hasOwnProperty(node.z));
        })

        // Add in the new config nodes
        nodes = newFlow.configs||[];
        if (newFlow.subflows) {
            // Add in the new subflows
            newFlow.subflows.forEach(function(sf) {
                nodes = nodes.concat(sf.nodes||[]).concat(sf.configs||[]);
                delete sf.nodes;
                delete sf.configs;
                nodes.push(sf);
            });
        }
    } else {
        newConfig = newConfig.filter(function(node) {
            return node.z !== id &#x26;&#x26; node.id !== id;
        });
        var tabNode = {
            type:&#x27;tab&#x27;,
            label:newFlow.label,
            id:id
        }
        nodes = [tabNode].concat(newFlow.nodes||[]).concat(newFlow.configs||[]);
        nodes.forEach(function(n) {
            n.z = id;
        });
    }

    newConfig = newConfig.concat(nodes);
    return setFlows(newConfig,&#x27;flows&#x27;,true).then(function() {
        log.info(log._(&#x22;nodes.flows.updated-flow&#x22;,{label:(label?label+&#x22; &#x22;:&#x22;&#x22;)+&#x22;[&#x22;+id+&#x22;]&#x22;}));
    })
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    })

},
put: function(req,res) {
    var id = req.params.id;
    var flow = req.body;
    try {
        redNodes.<span class="apidocCodeKeywordSpan">updateFlow</span>(id,flow).then(function() {
            log.audit({event: &#x22;flow.update&#x22;,id:id},req);
            res.json({id:id});
        }).otherwise(function(err) {
            log.audit({event: &#x22;flow.update&#x22;,error:err.code||&#x22;unexpected_error&#x22;,message:err.toString()},req);
            res.status(400).json({error:err.code||&#x22;unexpected_error&#x22;, message:err.toString()});
        })
    } catch(err) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.permissions" id="apidoc.module.node-red.permissions">module node-red.permissions</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.permissions.hasPermission" id="apidoc.element.node-red.permissions.hasPermission">
        function <span class="apidocSignatureSpan">node-red.permissions.</span>hasPermission
        <span class="apidocSignatureSpan">(userScope, permission)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function hasPermission(userScope, permission) {
    if (permission === &#x22;&#x22;) {
        return true;
    }
    var i;

    if (util.isArray(permission)) {
        // Multiple permissions requested - check each one
        for (i=0;i&#x3c;permission.length;i++) {
            if (!hasPermission(userScope,permission[i])) {
                return false;
            }
        }
        // All permissions check out
        return true;
    }

    if (util.isArray(userScope)) {
        if (userScope.length === 0) {
            return false;
        }
        for (i=0;i&#x3c;userScope.length;i++) {
            if (hasPermission(userScope[i],permission)) {
                return true;
            }
        }
        return false;
    }

    if (userScope === &#x22;*&#x22; || userScope === permission) {
        return true;
    }

    if (userScope === &#x22;read&#x22; || userScope === &#x22;*.read&#x22;) {
        return readRE.test(permission);
    } else if (userScope === &#x22;write&#x22; || userScope === &#x22;*.write&#x22;) {
        return writeRE.test(permission);
    }
    return false;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (!pendingAuth) {
    if (msg.subscribe) {
        handleRemoteSubscription(ws,msg.subscribe);
    }
} else {
    var completeConnection = function(userScope,sendAck) {
        try {
            if (!userScope || !Permissions.<span class="apidocCodeKeywordSpan">hasPermission</span>(userScope,&#x22;status.read&#
x22;)) {
                ws.send(JSON.stringify({auth:&#x22;fail&#x22;}));
                ws.close();
            } else {
                pendingAuth = false;
                removePendingConnection(ws);
                activeConnections.push(ws);
                if (sendAck) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.settings" id="apidoc.module.node-red.settings">module node-red.settings</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.settings.available" id="apidoc.element.node-red.settings.available">
        function <span class="apidocSignatureSpan">node-red.settings.</span>available
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">available = function () {
    return (globalSettings !== null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        var lang = locales.determineLangFromHeaders(req.acceptsLanguages());
        log.audit({event: &#x22;nodes.configs.get&#x22;},req);
        res.send(redNodes.getNodeConfigs(lang));
    }
},

post: function(req,res) {
    if (!settings.<span class="apidocCodeKeywordSpan">available</span>()) {
        log.audit({event: &#x22;nodes.install&#x22;,error:&#x22;settings_unavailable&#x22;},req);
        res.status(400).json({error:&#x22;settings_unavailable&#x22;, message:&#x22;Settings unavailable&#x22;});
        return;
    }
    var node = req.body;
    var promise;
    if (node.module) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.delete" id="apidoc.element.node-red.settings.delete">
        function <span class="apidocSignatureSpan">node-red.settings.</span>delete
        <span class="apidocSignatureSpan">(prop)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">delete = function (prop) {
    if (userSettings.hasOwnProperty(prop)) {
        throw new Error(log._(&#x22;settings.property-read-only&#x22;, {prop:prop}));
    }
    if (globalSettings === null) {
        throw new Error(log._(&#x22;settings.not-available&#x22;));
    }
    if (globalSettings.hasOwnProperty(prop)) {
        delete globalSettings[prop];
        return storage.saveSettings(globalSettings);
    }
    return when.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Flows
adminApp.get(&#x22;/flows&#x22;,needsPermission(&#x22;flows.read&#x22;),flows.get,errorHandler);
adminApp.post(&#x22;/flows&#x22;,needsPermission(&#x22;flows.write&#x22;),flows.post,errorHandler);

adminApp.get(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.read&#x22;),flow.get,errorHandler);
adminApp.post(&#x22;/flow&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.post,errorHandler);
adminApp.<span class="apidocCodeKeywordSpan">delete</span>(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.delete
,errorHandler);
adminApp.put(&#x22;/flow/:id&#x22;,needsPermission(&#x22;flows.write&#x22;),flow.put,errorHandler);

// Nodes
adminApp.get(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.read&#x22;),nodes.getAll,errorHandler);
adminApp.post(&#x22;/nodes&#x22;,needsPermission(&#x22;nodes.write&#x22;),nodes.post,errorHandler);

adminApp.get(/\/nodes\/((@[^\/]+\/)?[^\/]+)$/,needsPermission(&#x22;nodes.read&#x22;),nodes.getModule,errorHandler);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.get" id="apidoc.element.node-red.settings.get">
        function <span class="apidocSignatureSpan">node-red.settings.</span>get
        <span class="apidocSignatureSpan">(prop)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (prop) {
    if (userSettings.hasOwnProperty(prop)) {
        return clone(userSettings[prop]);
    }
    if (globalSettings === null) {
        throw new Error(log._(&#x22;settings.not-available&#x22;));
    }
    return clone(globalSettings[prop]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.init" id="apidoc.element.node-red.settings.init">
        function <span class="apidocSignatureSpan">node-red.settings.</span>init
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (settings) {
    userSettings = settings;
    for (var i in settings) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (settings.hasOwnProperty(i) &#x26;&#x26; i !== &#x27;load&#x27; &#x26;&#x26; i !== &#x27;get&#x27; &#x26;&#x26; i !== &#x27;set&#x27; &#x26;&#x26; i !== &#x27;available&#x27; &#x26;&#x26; i !== &#x27;reset&#x27;) {
            // Don&#x27;t allow any of the core functions get replaced via settings
            (function() {
                var j = i;
                persistentSettings.__defineGetter__(j,function() { return userSettings[j]; });
                persistentSettings.__defineSetter__(j,function() { throw new Error(&#x22;Property &#x27;&#x22;+j+&#x22;&#x27; is read-only&#x22;); });
            })();
        }
    }
    globalSettings = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.load" id="apidoc.element.node-red.settings.load">
        function <span class="apidocSignatureSpan">node-red.settings.</span>load
        <span class="apidocSignatureSpan">(_storage)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">load = function (_storage) {
    storage = _storage;
    return storage.getSettings().then(function(_settings) {
        globalSettings = _settings;
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
$(&#x22;#btn-usermenu-submenu li&#x22;).remove();
if (RED.settings.user.anonymous) {
    RED.menu.addItem(&#x22;btn-usermenu&#x22;,{
        id:&#x22;usermenu-item-login&#x22;,
        label:RED._(&#x22;menu.label.login&#x22;),
        onselect: function() {
            RED.user.login({cancelable:true},function() {
                RED.settings.<span class="apidocCodeKeywordSpan">load</span>(function() {
                    RED.notify(RED._(&#x22;user.loggedInAs&#x22;,{name:RED.settings.user.username}),&#x22;success&#x22;);
                    updateUserMenu();
                });
            });
        }
    });
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.reset" id="apidoc.element.node-red.settings.reset">
        function <span class="apidocSignatureSpan">node-red.settings.</span>reset
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reset = function () {
    for (var i in userSettings) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (userSettings.hasOwnProperty(i)) {
            delete persistentSettings[i];
        }
    }
    userSettings = null;
    globalSettings = null;
    storage = null;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.settings.set" id="apidoc.element.node-red.settings.set">
        function <span class="apidocSignatureSpan">node-red.settings.</span>set
        <span class="apidocSignatureSpan">(prop, value)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (prop, value) {
    if (userSettings.hasOwnProperty(prop)) {
        throw new Error(log._(&#x22;settings.property-read-only&#x22;, {prop:prop}));
    }
    if (globalSettings === null) {
        throw new Error(log._(&#x22;settings.not-available&#x22;));
    }
    var current = globalSettings[prop];
    globalSettings[prop] = value;
    try {
        assert.deepEqual(current,value);
        return when.resolve();
    } catch(err) {
        return storage.saveSettings(globalSettings);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

    return function(req,res,next) {
        if (req.method === &#x27;OPTIONS&#x27;) {
            return next();
        }
        var requestUser = basicAuth(req);
        if (!requestUser || requestUser.name !== user || !checkPassword(requestUser.pass)) {
            res.<span class="apidocCodeKeywordSpan">set</span>(&#x27;WWW-Authenticate&#x27;, &#x27;Basic realm=Authorization Required
&#x27;);
            return res.sendStatus(401);
        }
        next();
    }
}

if (settings.httpAdminRoot !== false &#x26;&#x26; settings.httpAdminAuth) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.strategies" id="apidoc.module.node-red.strategies">module node-red.strategies</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.strategies.bearerStrategy" id="apidoc.element.node-red.strategies.bearerStrategy">
        function <span class="apidocSignatureSpan">node-red.strategies.</span>bearerStrategy
        <span class="apidocSignatureSpan">(accessToken, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">bearerStrategy = function (accessToken, done) {
    // is this a valid token?
    Tokens.get(accessToken).then(function(token) {
        if (token) {
            Users.get(token.user).then(function(user) {
                if (user) {
                    done(null,user,{scope:token.scope});
                } else {
                    log.audit({event: &#x22;auth.invalid-token&#x22;});
                    done(null,false);
                }
            });
        } else {
            log.audit({event: &#x22;auth.invalid-token&#x22;});
            done(null,false);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.strategies.clientPasswordStrategy" id="apidoc.element.node-red.strategies.clientPasswordStrategy">
        function <span class="apidocSignatureSpan">node-red.strategies.</span>clientPasswordStrategy
        <span class="apidocSignatureSpan">(clientId, clientSecret, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clientPasswordStrategy = function (clientId, clientSecret, done) {
    Clients.get(clientId).then(function(client) {
        if (client &#x26;&#x26; client.secret == clientSecret) {
            done(null,client);
        } else {
            log.audit({event: &#x22;auth.invalid-client&#x22;,client:clientId});
            done(null,false);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.strategies.init" id="apidoc.element.node-red.strategies.init">
        function <span class="apidocSignatureSpan">node-red.strategies.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    log = runtime.log;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.strategies.passwordTokenExchange" id="apidoc.element.node-red.strategies.passwordTokenExchange">
        function <span class="apidocSignatureSpan">node-red.strategies.</span>passwordTokenExchange
        <span class="apidocSignatureSpan">(client, username, password, scope, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">passwordTokenExchange = function (client, username, password, scope, done) {
    var now = Date.now();
    loginAttempts = loginAttempts.filter(function(logEntry) {
        return logEntry.time + loginSignInWindow &#x3e; now;
    });
    loginAttempts.push({time:now, user:username});
    var attemptCount = 0;
    loginAttempts.forEach(function(logEntry) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (logEntry.user == username) {
            attemptCount++;
        }
    });
    if (attemptCount &#x3e; 5) {
        log.audit({event: &#x22;auth.login.fail.too-many-attempts&#x22;,username:username,client:client.id});
        done(new Error(&#x22;Too many login attempts. Wait 10 minutes and try again&#x22;),false);
        return;
    }

    Users.authenticate(username,password).then(function(user) {
        if (user) {
            if (scope === &#x22;&#x22;) {
                scope = user.permissions;
            }
            if (permissions.hasPermission(user.permissions,scope)) {
                loginAttempts = loginAttempts.filter(function(logEntry) {
                    return logEntry.user !== username;
                });
                Tokens.create(username,client.id,scope).then(function(tokens) {
                    log.audit({event: &#x22;auth.login&#x22;,username:username,client:client.id,scope:scope});
                    done(null,tokens.accessToken,null,{expires_in:tokens.expires_in});
                });
            } else {
                log.audit({event: &#x22;auth.login.fail.permissions&#x22;,username:username,client:client.id,scope:scope});
                done(null,false);
            }
        } else {
            log.audit({event: &#x22;auth.login.fail.credentials&#x22;,username:username,client:client.id,scope:scope});
            done(null,false);
        }
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.theme" id="apidoc.module.node-red.theme">module node-red.theme</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.theme.app" id="apidoc.element.node-red.theme.app">
        function <span class="apidocSignatureSpan">node-red.theme.</span>app
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">app = function () {
    var i;
    var url;
    themeSettings = {};

    var themeApp = express();

    if (theme.page) {
        if (theme.page.css) {
            var styles = theme.page.css;
            if (!util.isArray(styles)) {
                styles = [styles];
            }
            themeContext.page.css = [];

            for (i=0;i&#x3c;styles.length;i++) {
                url = serveFile(themeApp,&#x22;/css/&#x22;,styles[i]);
                if (url) {
                    themeContext.page.css.push(url);
                }
            }
        }

        if (theme.page.favicon) {
            url = serveFile(themeApp,&#x22;/favicon/&#x22;,theme.page.favicon)
            if (url) {
                themeContext.page.favicon = url;
            }
        }

        if (theme.page.tabicon) {
            url = serveFile(themeApp,&#x22;/tabicon/&#x22;,theme.page.tabicon)
            if (url) {
                themeContext.page.tabicon = url;
            }
        }

        themeContext.page.title = theme.page.title || themeContext.page.title;
    }

    if (theme.header) {

        themeContext.header.title = theme.header.title || themeContext.header.title;

        if (theme.header.hasOwnProperty(&#x22;url&#x22;)) {
            themeContext.header.url = theme.header.url;
        }

        if (theme.header.hasOwnProperty(&#x22;image&#x22;)) {
            if (theme.header.image) {
                url = serveFile(themeApp,&#x22;/header/&#x22;,theme.header.image);
                if (url) {
                    themeContext.header.image = url;
                }
            } else {
                themeContext.header.image = null;
            }
        }
    }

    if (theme.deployButton) {
        if (theme.deployButton.type == &#x22;simple&#x22;) {
            themeSettings.deployButton = {
                type: &#x22;simple&#x22;
            }
            if (theme.deployButton.label) {
                themeSettings.deployButton.label = theme.deployButton.label;
            }
            if (theme.deployButton.icon) {
                url = serveFile(themeApp,&#x22;/deploy/&#x22;,theme.deployButton.icon);
                if (url) {
                    themeSettings.deployButton.icon = url;
                }
            }
        }
    }

    if (theme.hasOwnProperty(&#x22;userMenu&#x22;)) {
        themeSettings.userMenu = theme.userMenu;
    }

    if (theme.login) {
        if (theme.login.image) {
            url = serveFile(themeApp,&#x22;/login/&#x22;,theme.login.image);
            if (url) {
                themeContext.login = {
                    image: url
                }
            }
        }
    }

    if (theme.hasOwnProperty(&#x22;menu&#x22;)) {
        themeSettings.menu = theme.menu;
    }

    if (theme.hasOwnProperty(&#x22;palette&#x22;)) {
        themeSettings.palette = theme.palette;
    }
    return themeApp;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
            }
        });
    }
    editorApp.get(&#x22;/&#x22;,ensureRuntimeStarted,ui.ensureSlash,ui.editor);
    editorApp.get(&#x22;/icons/:icon&#x22;,ui.icon);
    theme.init(runtime);
    if (settings.editorTheme) {
        editorApp.use(&#x22;/theme&#x22;,theme.<span class="apidocCodeKeywordSpan">app</span>());
    }
    editorApp.use(&#x22;/&#x22;,ui.editorResources);
    adminApp.use(editorApp);
}
var maxApiRequestSize = settings.apiMaxLength || &#x27;5mb&#x27;;
adminApp.use(bodyParser.json({limit:maxApiRequestSize}));
adminApp.use(bodyParser.urlencoded({limit:maxApiRequestSize,extended:true}));
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.theme.context" id="apidoc.element.node-red.theme.context">
        function <span class="apidocSignatureSpan">node-red.theme.</span>context
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">context = function () {
    return themeContext;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    // iconPath doesn&#x27;t exist
                }
            }
            res.sendFile(defaultIcon);
        }
    },
    editor: function(req,res) {
        res.send(Mustache.render(editorTemplate,theme.<span class="apidocCodeKeywordSpan">context</span>()));
    },
    editorResources: express.static(__dirname + &#x27;/../../public&#x27;)
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.theme.init" id="apidoc.element.node-red.theme.init">
        function <span class="apidocSignatureSpan">node-red.theme.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    var settings = runtime.settings;
    themeContext = clone(defaultContext);
    if (runtime.version) {
        themeContext.version = runtime.version();
    }
    themeSettings = null;
    theme = settings.editorTheme;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.theme.settings" id="apidoc.element.node-red.theme.settings">
        function <span class="apidocSignatureSpan">node-red.theme.</span>settings
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">settings = function () {
    return themeSettings;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    settings: function(req,res) {
var safeSettings = {
    httpNodeRoot: settings.httpNodeRoot||&#x22;/&#x22;,
    version: settings.version,
    user: req.user
}

var themeSettings = theme.<span class="apidocCodeKeywordSpan">settings</span>();
if (themeSettings) {
    safeSettings.editorTheme = themeSettings;
}

if (util.isArray(settings.paletteCategories)) {
    safeSettings.paletteCategories = settings.paletteCategories;
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.tokens" id="apidoc.module.node-red.tokens">module node-red.tokens</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.tokens.create" id="apidoc.element.node-red.tokens.create">
        function <span class="apidocSignatureSpan">node-red.tokens.</span>create
        <span class="apidocSignatureSpan">(user, client, scope)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (user, client, scope) {
    return loadSessions().then(function() {
        var accessToken = generateToken(128);

        var accessTokenExpiresAt = Date.now() + (sessionExpiryTime*1000);

        var session = {
            user:user,
            client:client,
            scope:scope,
            accessToken: accessToken,
            expires: accessTokenExpiresAt
        };
        sessions[accessToken] = session;
        return storage.saveSessions(sessions).then(function() {
            return {
                accessToken: accessToken,
                expires_in: sessionExpiryTime
            }
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        setTimeout: true,
        clearTimeout: true,
        setInterval: true,
        clearInterval: true
    }
});

RED.library.<span class="apidocCodeKeywordSpan">create</span>({
    url:&#x22;functions&#x22;, // where to get the data from
    type:&#x22;function&#x22;, // the type of object the library is for
    editor:this.editor, // the field name the main text body goes to
    mode:&#x22;ace/mode/javascript&#x22;,
    fields:[&#x27;name&#x27;,&#x27;outputs&#x27;]
});
this.editor.focus();
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.tokens.get" id="apidoc.element.node-red.tokens.get">
        function <span class="apidocSignatureSpan">node-red.tokens.</span>get
        <span class="apidocSignatureSpan">(token)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (token) {
    return loadSessions().then(function() {
        if (sessions[token]) {
            if (sessions[token].expires &#x3c; Date.now()) {
                return expireSessions().then(function() { return null });
            }
        }
        return when.resolve(sessions[token]);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.tokens.init" id="apidoc.element.node-red.tokens.init">
        function <span class="apidocSignatureSpan">node-red.tokens.</span>init
        <span class="apidocSignatureSpan">(adminAuthSettings, _storage)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (adminAuthSettings, _storage) {
    storage = _storage;
    sessionExpiryTime = adminAuthSettings.sessionExpiryTime || 604800; // 1 week in seconds
    // At this point, storage will not have been initialised, so defer loading
    // the sessions until there&#x27;s a request for them.
    loadedSessions = null;
    return when.resolve();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.tokens.revoke" id="apidoc.element.node-red.tokens.revoke">
        function <span class="apidocSignatureSpan">node-red.tokens.</span>revoke
        <span class="apidocSignatureSpan">(token)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">revoke = function (token) {
    return loadSessions().then(function() {
        delete sessions[token];
        return storage.saveSessions(sessions);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
res.json(response);
}

function revoke(req,res) {
var token = req.body.token;
// TODO: audit log
Tokens.<span class="apidocCodeKeywordSpan">revoke</span>(token).then(function() {
    log.audit({event: &#x22;auth.login.revoke&#x22;},req);
    res.status(200).end();
});
}

module.exports = {
init: init,
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.ui" id="apidoc.module.node-red.ui">module node-red.ui</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.ui.editor" id="apidoc.element.node-red.ui.editor">
        function <span class="apidocSignatureSpan">node-red.ui.</span>editor
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">editor = function (req, res) {
    res.send(Mustache.render(editorTemplate,theme.context()));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.ui.editorResources" id="apidoc.element.node-red.ui.editorResources">
        function <span class="apidocSignatureSpan">node-red.ui.</span>editorResources
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function serveStatic(req, res, next) {
  if (req.method !== &#x27;GET&#x27; &#x26;&#x26; req.method !== &#x27;HEAD&#x27;) {
    if (fallthrough) {
      return next()
    }

    // method not allowed
    res.statusCode = 405
    res.setHeader(&#x27;Allow&#x27;, &#x27;GET, HEAD&#x27;)
    res.setHeader(&#x27;Content-Length&#x27;, &#x27;0&#x27;)
    res.end()
    return
  }

  var forwardError = !fallthrough
  var originalUrl = parseUrl.original(req)
  var path = parseUrl(req).pathname

  // make sure redirect occurs at mount
  if (path === &#x27;/&#x27; &#x26;&#x26; originalUrl.pathname.substr(-1) !== &#x27;/&#x27;) {
    path = &#x27;&#x27;
  }

  // create send stream
  var stream = send(req, path, opts)

  // add directory handler
  stream.on(&#x27;directory&#x27;, onDirectory)

  // add headers listener
  if (setHeaders) {
    stream.on(&#x27;headers&#x27;, setHeaders)
  }

  // add file listener for fallthrough
  if (fallthrough) {
    stream.on(&#x27;file&#x27;, function onFile () {
      // once file is determined, always forward error
      forwardError = true
    })
  }

  // forward errors
  stream.on(&#x27;error&#x27;, function error (err) {
    if (forwardError || !(err.statusCode &#x3c; 500)) {
      next(err)
      return
    }

    next()
  })

  // pipe
  stream.pipe(res)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.ui.ensureSlash" id="apidoc.element.node-red.ui.ensureSlash">
        function <span class="apidocSignatureSpan">node-red.ui.</span>ensureSlash
        <span class="apidocSignatureSpan">(req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ensureSlash = function (req, res, next) {
    var parts = req.originalUrl.split(&#x22;?&#x22;);
    if (parts[0].slice(-1) != &#x22;/&#x22;) {
        parts[0] += &#x22;/&#x22;;
        var redirect = parts.join(&#x22;?&#x22;);
        res.redirect(301,redirect);
    } else {
        next();
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.ui.icon" id="apidoc.element.node-red.ui.icon">
        function <span class="apidocSignatureSpan">node-red.ui.</span>icon
        <span class="apidocSignatureSpan">(req, res)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">icon = function (req, res) {
    if (iconCache[req.params.icon]) {
        res.sendFile(iconCache[req.params.icon]); // if not found, express prints this to the console and serves 404
    } else {
        for (var p=0;p&#x3c;icon_paths.length;p++) {
            var iconPath = path.join(icon_paths[p],req.params.icon);
            try {
                fs.statSync(iconPath);
                res.sendFile(iconPath);
                iconCache[req.params.icon] = iconPath;
                return;
            } catch(err) {
                // iconPath doesn&#x27;t exist
            }
        }
        res.sendFile(defaultIcon);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.ui.init" id="apidoc.element.node-red.ui.init">
        function <span class="apidocSignatureSpan">node-red.ui.</span>init
        <span class="apidocSignatureSpan">(runtime)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (runtime) {
    editorTemplate = fs.readFileSync(path.join(templateDir,&#x22;index.mst&#x22;),&#x22;utf8&#x22;);
    Mustache.parse(editorTemplate);
    // TODO: this allows init to be called multiple times without
    //       registering multiple instances of the listener.
    //       It isn&#x27;t.... ideal.
    runtime.events.removeListener(&#x22;node-icon-dir&#x22;,nodeIconDir);
    runtime.events.on(&#x22;node-icon-dir&#x22;,nodeIconDir);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.users" id="apidoc.module.node-red.users">module node-red.users</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.users.authenticate" id="apidoc.element.node-red.users.authenticate">
        function <span class="apidocSignatureSpan">node-red.users.</span>authenticate
        <span class="apidocSignatureSpan">(username, password)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">authenticate = function (username, password) { return api.authenticate(username,password) }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    strategies.init(runtime);
}
}

function needsPermission(permission) {
return function(req,res,next) {
    if (settings &#x26;&#x26; settings.adminAuth) {
        return passport.<span class="apidocCodeKeywordSpan">authenticate</span>([&#x27;bearer&#x27;,&#x27;anon&#x27;],{ session:
false })(req,res,function() {
            if (!req.user) {
                return next();
            }
            if (permissions.hasPermission(req.authInfo.scope,permission)) {
                return next();
            }
            log.audit({event: &#x22;permission.fail&#x22;, permissions: permission},req);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.users.default" id="apidoc.element.node-red.users.default">
        function <span class="apidocSignatureSpan">node-red.users.</span>default
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">default = function () { return api.default(); }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}

function start() {
var Tokens = require(&#x22;./auth/tokens&#x22;);
var Users = require(&#x22;./auth/users&#x22;);
var Permissions = require(&#x22;./auth/permissions&#x22;);
if (!settings.disableEditor) {
    Users.<span class="apidocCodeKeywordSpan">default</span>().then(function(anonymousUser) {
        var webSocketKeepAliveTime = settings.webSocketKeepAliveTime || 15000;
        var path = settings.httpAdminRoot || &#x22;/&#x22;;
        path = (path.slice(0,1) != &#x22;/&#x22; ? &#x22;/&#x22;:&#x22;&#x22;) + path + (path.slice(-1) == &#x22;/&#x22; ? &#x22
;&#x22;:&#x22;/&#x22;) + &#x22;comms&#x22;;
        wsServer = new ws.Server({
            server:server,
            path:path,
            // Disable the deflate option due to this issue
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.users.get" id="apidoc.element.node-red.users.get">
        function <span class="apidocSignatureSpan">node-red.users.</span>get
        <span class="apidocSignatureSpan">(username)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (username) { return api.get(username) }</pre></li>
    <li>example usage<pre class="apidocCodePre">...
                    if (topic == &#x22;node/added&#x22;) {
var addedTypes = [];
msg.forEach(function(m) {
    var id = m.id;
    RED.nodes.addNodeSet(m);
    addedTypes = addedTypes.concat(m.types);
    RED.i18n.loadCatalog(id, function() {
        $.<span class="apidocCodeKeywordSpan">get</span>(&#x27;nodes/&#x27;+id, function(data) {
            $(&#x22;body&#x22;).append(data);
        });
    });
});
if (addedTypes.length) {
    typeList = &#x22;&#x3c;ul&#x3e;&#x3c;li&#x3e;&#x22;+addedTypes.join(&#x22;&#x3c;/li&#x3e;&#x3c;li&#x3e;&#x22;)+&#x22;&#x3c;/
li&#x3e;&#x3c;/ul&#x3e;&#x22;;
    RED.notify(RED._(&#x22;palette.event.nodeAdded&#x22;, {count:addedTypes.length})+typeList,&#x22;success&#x22;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.users.init" id="apidoc.element.node-red.users.init">
        function <span class="apidocSignatureSpan">node-red.users.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function init(config) {
    users = {};
    passwords = {};
    defaultUser = null;
    if (config.type == &#x22;credentials&#x22;) {
        if (config.users) {
            if (typeof config.users === &#x22;function&#x22;) {
                api.get = config.users;
            } else {
                var us = config.users;
<span class="apidocCodeCommentSpan">                /* istanbul ignore else */
</span>                if (!util.isArray(us)) {
                    us = [us];
                }
                for (var i=0;i&#x3c;us.length;i++) {
                    var u = us[i];
                    users[u.username] = {
                        &#x22;username&#x22;:u.username,
                        &#x22;permissions&#x22;:u.permissions
                    };
                    passwords[u.username] = u.password;
                }
            }
        }
        if (config.authenticate &#x26;&#x26; typeof config.authenticate === &#x22;function&#x22;) {
            api.authenticate = config.authenticate;
        } else {
            api.authenticate = authenticate;
        }
    }
    if (config.default) {
        if (typeof config.default === &#x22;function&#x22;) {
            api.default = config.default;
        } else {
            api.default = function() {
                return when.resolve({
                    &#x22;anonymous&#x22;: true,
                    &#x22;permissions&#x22;:config.default.permissions
                });
            }
        }
    } else {
        api.default = getDefaultUser;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
settings.flowFile = flowFile;
}
if (parsedArgs.userDir) {
settings.userDir = parsedArgs.userDir;
}

try {
RED.<span class="apidocCodeKeywordSpan">init</span>(server,settings);
} catch(err) {
if (err.code == &#x22;unsupported_version&#x22;) {
    console.log(&#x22;Unsupported version of node.js:&#x22;,process.version);
    console.log(&#x22;Node-RED requires node.js v4 or later&#x22;);
} else if  (err.code == &#x22;not_built&#x22;) {
    console.log(&#x22;Node-RED has not been built. See README.md for details&#x22;);
} else {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red.util" id="apidoc.module.node-red.util">module node-red.util</a></h1>


    <h2>
        <a href="#apidoc.element.node-red.util.cloneMessage" id="apidoc.element.node-red.util.cloneMessage">
        function <span class="apidocSignatureSpan">node-red.util.</span>cloneMessage
        <span class="apidocSignatureSpan">(msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function cloneMessage(msg) {
    // Temporary fix for #97
    // TODO: remove this http-node-specific fix somehow
    var req = msg.req;
    var res = msg.res;
    delete msg.req;
    delete msg.res;
    var m = clone(msg);
    if (req) {
        m.req = req;
        msg.req = req;
    }
    if (res) {
        m.res = res;
        msg.res = res;
    }
    return m;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}
node.activeProcesses[child.pid] = child;
child.stdout.on(&#x27;data&#x27;, function (data) {
    if (node.activeProcesses.hasOwnProperty(child.pid) &#x26;&#x26; node.activeProcesses[child.pid] !== null) {
        // console.log(&#x27;[exec] stdout: &#x27; + data,child.pid);
        if (isUtf8(data)) { msg.payload = data.toString(); }
        else { msg.payload = data; }
        node.send([RED.util.<span class="apidocCodeKeywordSpan">cloneMessage</span>(msg),null,null]);
    }
});
child.stderr.on(&#x27;data&#x27;, function (data) {
    if (node.activeProcesses.hasOwnProperty(child.pid) &#x26;&#x26; node.activeProcesses[child.pid] !== null) {
        if (isUtf8(data)) { msg.payload = data.toString(); }
        else { msg.payload = new Buffer(data); }
        node.send([null,RED.util.cloneMessage(msg),null]);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.compareObjects" id="apidoc.element.node-red.util.compareObjects">
        function <span class="apidocSignatureSpan">node-red.util.</span>compareObjects
        <span class="apidocSignatureSpan">(obj1, obj2)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function compareObjects(obj1, obj2) {
    var i;
    if (obj1 === obj2) {
        return true;
    }
    if (obj1 == null || obj2 == null) {
        return false;
    }

    var isArray1 = Array.isArray(obj1);
    var isArray2 = Array.isArray(obj2);
    if (isArray1 != isArray2) {
        return false;
    }
    if (isArray1 &#x26;&#x26; isArray2) {
        if (obj1.length !== obj2.length) {
            return false;
        }
        for (i=0;i&#x3c;obj1.length;i++) {
            if (!compareObjects(obj1[i],obj2[i])) {
                return false;
            }
        }
        return true;
    }
    var isBuffer1 = Buffer.isBuffer(obj1);
    var isBuffer2 = Buffer.isBuffer(obj2);
    if (isBuffer1 != isBuffer2) {
        return false;
    }
    if (isBuffer1 &#x26;&#x26; isBuffer2) {
        if (obj1.equals) {
            // For node 0.12+ - use the native equals
            return obj1.equals(obj2);
        } else {
            if (obj1.length !== obj2.length) {
                return false;
            }
            for (i=0;i&#x3c;obj1.length;i++) {
                if (obj1.readUInt8(i) !== obj2.readUInt8(i)) {
                    return false;
                }
            }
            return true;
        }
    }

    if (typeof obj1 !== &#x27;object&#x27; || typeof obj2 !== &#x27;object&#x27;) {
        return false;
    }
    var keys1 = Object.keys(obj1);
    var keys2 = Object.keys(obj2);
    if (keys1.length != keys2.length) {
        return false;
    }
    for (var k in obj1) {
<span class="apidocCodeCommentSpan">        /* istanbul ignore else */
</span>        if (obj1.hasOwnProperty(k)) {
            if (!compareObjects(obj1[k],obj2[k])) {
                return false;
            }
        }
    }
    return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.ensureBuffer" id="apidoc.element.node-red.util.ensureBuffer">
        function <span class="apidocSignatureSpan">node-red.util.</span>ensureBuffer
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ensureBuffer(o) {
    if (Buffer.isBuffer(o)) {
        return o;
    } else if (typeof o === &#x22;object&#x22;) {
        o = JSON.stringify(o);
    } else if (typeof o !== &#x22;string&#x22;) {
        o = &#x22;&#x22;+o;
    }
    return new Buffer(o);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.ensureString" id="apidoc.element.node-red.util.ensureString">
        function <span class="apidocSignatureSpan">node-red.util.</span>ensureString
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ensureString(o) {
    if (Buffer.isBuffer(o)) {
        return o.toString();
    } else if (typeof o === &#x22;object&#x22;) {
        return JSON.stringify(o);
    } else if (typeof o === &#x22;string&#x22;) {
        return o;
    }
    return &#x22;&#x22;+o;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        this.on(&#x22;input&#x22;, function(msg) {
var payload;
if (this.serverConfig.wholemsg) {
    delete msg._session;
    payload = JSON.stringify(msg);
} else if (msg.hasOwnProperty(&#x22;payload&#x22;)) {
    if (!Buffer.isBuffer(msg.payload)) { // if it&#x27;s not a buffer make sure it&#x27;s a string.
        payload = RED.util.<span class="apidocCodeKeywordSpan">ensureString</span>(msg.payload);
    }
    else {
        payload = msg.payload;
    }
}
if (payload) {
    if (msg._session &#x26;&#x26; msg._session.type == &#x22;websocket&#x22;) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.evaluateNodeProperty" id="apidoc.element.node-red.util.evaluateNodeProperty">
        function <span class="apidocSignatureSpan">node-red.util.</span>evaluateNodeProperty
        <span class="apidocSignatureSpan">(value, type, node, msg)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function evaluateNodeProperty(value, type, node, msg) {
    if (type === &#x27;str&#x27;) {
        return &#x22;&#x22;+value;
    } else if (type === &#x27;num&#x27;) {
        return Number(value);
    } else if (type === &#x27;json&#x27;) {
        return JSON.parse(value);
    } else if (type === &#x27;re&#x27;) {
        return new RegExp(value);
    } else if (type === &#x27;date&#x27;) {
        return Date.now();
    } else if (type === &#x27;msg&#x27; &#x26;&#x26; msg) {
        return getMessageProperty(msg,value);
    } else if (type === &#x27;flow&#x27; &#x26;&#x26; node) {
        return node.context().flow.get(value);
    } else if (type === &#x27;global&#x27; &#x26;&#x26; node) {
        return node.context().global.get(value);
    } else if (type === &#x27;bool&#x27;) {
        return /^true$/i.test(value);
    } else if (type === &#x27;jsonata&#x27;) {
        return jsonata(value).evaluate({msg:msg});
    }
    return value;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        if ( (this.payloadType == null &#x26;&#x26; this.payload === &#x22;&#x22;) || this.payloadType === &#x22;date&#x22;) {
            msg.payload = Date.now();
        } else if (this.payloadType == null) {
            msg.payload = this.payload;
        } else if (this.payloadType == &#x27;none&#x27;) {
            msg.payload = &#x22;&#x22;;
        } else {
            msg.payload = RED.util.<span class="apidocCodeKeywordSpan">evaluateNodeProperty</span>(this.payload,this.payloadType
,this,msg);
        }
        this.send(msg);
        msg = null;
    } catch(err) {
        this.error(err,msg);
    }
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.generateId" id="apidoc.element.node-red.util.generateId">
        function <span class="apidocSignatureSpan">node-red.util.</span>generateId
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function generateId() {
    return (1+Math.random()*4294967295).toString(16);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

this.errorHandler = function(err,req,res,next) {
    node.warn(err);
    res.sendStatus(500);
};

this.callback = function(req,res) {
    var msgid = RED.util.<span class="apidocCodeKeywordSpan">generateId</span>();
    res._msgid = msgid;
    if (node.method.match(/^(post|delete|put|options|patch)$/)) {
        node.send({_msgid:msgid,req:req,res:createResponseWrapper(node,res),payload:req.body});
    } else if (node.method == &#x22;get&#x22;) {
        node.send({_msgid:msgid,req:req,res:createResponseWrapper(node,res),payload:req.query});
    } else {
        node.send({_msgid:msgid,req:req,res:createResponseWrapper(node,res)});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.getMessageProperty" id="apidoc.element.node-red.util.getMessageProperty">
        function <span class="apidocSignatureSpan">node-red.util.</span>getMessageProperty
        <span class="apidocSignatureSpan">(msg, expr)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function getMessageProperty(msg, expr) {
    var result = null;
    if (expr.indexOf(&#x27;msg.&#x27;)===0) {
        expr = expr.substring(4);
    }
    var msgPropParts = normalisePropertyExpression(expr);
    var m;
    msgPropParts.reduce(function(obj, key) {
        result = (typeof obj[key] !== &#x22;undefined&#x22; ? obj[key] : undefined);
        return result;
    }, msg);
    return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
} else {
// debug user defined msg property
    var property = &#x22;payload&#x22;;
    var output = msg[property];
    if (this.complete !== &#x22;false&#x22; &#x26;&#x26; typeof this.complete !== &#x22;undefined&#x22;) {
        property = this.complete;
        try {
            output = RED.util.<span class="apidocCodeKeywordSpan">getMessageProperty</span>(msg,this.complete);
        } catch(err) {
            output = undefined;
        }
    }
    if (this.console === &#x22;true&#x22;) {
        if (typeof output === &#x22;string&#x22;) {
            node.log((output.indexOf(&#x22;\n&#x22;) !== -1 ? &#x22;\n&#x22; : &#x22;&#x22;) + output);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.normalisePropertyExpression" id="apidoc.element.node-red.util.normalisePropertyExpression">
        function <span class="apidocSignatureSpan">node-red.util.</span>normalisePropertyExpression
        <span class="apidocSignatureSpan">(str)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function normalisePropertyExpression(str) {
    // This must be kept in sync with validatePropertyExpression
    // in editor/js/ui/utils.js

    var length = str.length;
    if (length === 0) {
        throw new Error(&#x22;Invalid property expression: zero-length&#x22;);
    }
    var parts = [];
    var start = 0;
    var inString = false;
    var inBox = false;
    var quoteChar;
    var v;
    for (var i=0;i&#x3c;length;i++) {
        var c = str[i];
        if (!inString) {
            if (c === &#x22;&#x27;&#x22; || c === &#x27;&#x22;&#x27;) {
                if (i != start) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+c+&#x22; at position &#x22;+i);
                }
                inString = true;
                quoteChar = c;
                start = i+1;
            } else if (c === &#x27;.&#x27;) {
                if (i===0) {
                    throw new Error(&#x22;Invalid property expression: unexpected . at position 0&#x22;);
                }
                if (start != i) {
                    v = str.substring(start,i);
                    if (/^\d+$/.test(v)) {
                        parts.push(parseInt(v));
                    } else {
                        parts.push(v);
                    }
                }
                if (i===length-1) {
                    throw new Error(&#x22;Invalid property expression: unterminated expression&#x22;);
                }
                // Next char is first char of an identifier: a-z 0-9 $ _
                if (!/[a-z0-9\$\_]/i.test(str[i+1])) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+str[i+1]+&#x22; at position &#x22;+(i+1));
                }
                start = i+1;
            } else if (c === &#x27;[&#x27;) {
                if (i === 0) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+c+&#x22; at position &#x22;+i);
                }
                if (start != i) {
                    parts.push(str.substring(start,i));
                }
                if (i===length-1) {
                    throw new Error(&#x22;Invalid property expression: unterminated expression&#x22;);
                }
                // Next char is either a quote or a number
                if (!/[&#x22;&#x27;\d]/.test(str[i+1])) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+str[i+1]+&#x22; at position &#x22;+(i+1));
                }
                start = i+1;
                inBox = true;
            } else if (c === &#x27;]&#x27;) {
                if (!inBox) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+c+&#x22; at position &#x22;+i);
                }
                if (start != i) {
                    v = str.substring(start,i);
                    if (/^\d+$/.test(v)) {
                        parts.push(parseInt(v));
                    } else {
                        throw new Error(&#x22;Invalid property expression: unexpected array expression at position &#x22;+start);
                    }
                }
                start = i+1;
                inBox = false;
            } else if (c === &#x27; &#x27;) {
                throw new Error(&#x22;Invalid property expression: unexpected &#x27; &#x27; at position &#x22;+i);
            }
        } else {
            if (c === quoteChar) {
                if (i-start === 0) {
                    throw new Error(&#x22;Invalid property expression: zero-length string at position &#x22;+start);
                }
                parts.push(str.substring(start,i));
                // If inBox, next char must be a ]. Otherwise it may be [ or .
                if (inBox &#x26;&#x26; !/\]/.test(str[i+1])) {
                    throw new Error(&#x22;Invalid property expression: unexpected array expression at position &#x22;+start);
                } else if (!inBox &#x26;&#x26; i+1!==length &#x26;&#x26; !/[\[\.]/.test(str[i+1])) {
                    throw new Error(&#x22;Invalid property expression: unexpected &#x22;+str[i+1]+&#x22; expression at position &#x22;+(i+1));
                }
                start = i+1;
                inString = false;
            }
        }

    }
    if (inBox || inString) {
        throw new Error(&#x22;Invalid property expression: unterminated expression&#x22;);
    }
    if ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red.util.setMessageProperty" id="apidoc.element.node-red.util.setMessageProperty">
        function <span class="apidocSignatureSpan">node-red.util.</span>setMessageProperty
        <span class="apidocSignatureSpan">(msg, prop, value, createMissing)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function setMessageProperty(msg, prop, value, createMissing) {
    if (typeof createMissing === &#x27;undefined&#x27;) {
        createMissing = (typeof value !== &#x27;undefined&#x27;);
    }
    if (prop.indexOf(&#x27;msg.&#x27;)===0) {
        prop = prop.substring(4);
    }
    var msgPropParts = normalisePropertyExpression(prop);
    var depth = 0;
    var length = msgPropParts.length;
    var obj = msg;
    var key;
    for (var i=0;i&#x3c;length-1;i++) {
        key = msgPropParts[i];
        if (typeof key === &#x27;string&#x27; || (typeof key === &#x27;number&#x27; &#x26;&#x26; !Array.isArray(obj))) {
            if (obj.hasOwnProperty(key)) {
                obj = obj[key];
            } else if (createMissing) {
                if (typeof msgPropParts[i+1] === &#x27;string&#x27;) {
                    obj[key] = {};
                } else {
                    obj[key] = [];
                }
                obj = obj[key];
            } else {
                return null;
            }
        } else if (typeof key === &#x27;number&#x27;) {
            // obj is an array
            if (obj[key] === undefined) {
                if (createMissing) {
                    if (typeof msgPropParts[i+1] === &#x27;string&#x27;) {
                        obj[key] = {};
                    } else {
                        obj[key] = [];
                    }
                    obj = obj[key];
                } else {
                    return null
                }
            } else {
                obj = obj[key];
            }
        }
    }
    key = msgPropParts[length-1];
    if (typeof value === &#x22;undefined&#x22;) {
        if (typeof key === &#x27;number&#x27; &#x26;&#x26; Array.isArray(obj)) {
            obj.splice(key,1);
        } else {
            delete obj[key]
        }
    } else {
        obj[key] = value;
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var value;
    if (node.syntax === &#x22;mustache&#x22;) {
        value = mustache.render(node.template,new NodeContext(msg, node.context()));
    } else {
        value = node.template;
    }
    if (node.fieldType === &#x27;msg&#x27;) {
        RED.util.<span class="apidocCodeKeywordSpan">setMessageProperty</span>(msg,node.field,value);
    } else if (node.fieldType === &#x27;flow&#x27;) {
        node.context().flow.set(node.field,value);
    } else if (node.fieldType === &#x27;global&#x27;) {
        node.context().global.set(node.field,value);
    }
    node.send(msg);
} catch(err) {
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
